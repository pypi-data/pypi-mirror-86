
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Slack Quickstart &#8212; Flask Dance 1.3.0 documentation</title>
    <link rel="stylesheet" href="../_static/flasky.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Azure Quickstart" href="azure.html" />
    <link rel="prev" title="Meetup Quickstart" href="meetup.html" />
     
    
    <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head><body>
    
    

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="azure.html" title="Azure Quickstart"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="meetup.html" title="Meetup Quickstart"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Flask Dance 1.3.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Quickstarts</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="slack-quickstart">
<h1>Slack Quickstart<a class="headerlink" href="#slack-quickstart" title="Permalink to this headline">¶</a></h1>
<div class="section" id="set-up-the-application">
<h2>Set up the application<a class="headerlink" href="#set-up-the-application" title="Permalink to this headline">¶</a></h2>
<p>Visit <a class="reference external" href="https://api.slack.com/applications/new">https://api.slack.com/applications/new</a>
to register an application on Slack. The application’s “Redirect URI(s)”
must contain <code class="docutils literal notranslate"><span class="pre">http://localhost:5000/login/slack/authorized</span></code>.
Take note of the “Client ID” and “Client Secret” for the application.</p>
</div>
<div class="section" id="code">
<h2>Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span>
<span class="kn">from</span> <span class="nn">flask_dance.contrib.slack</span> <span class="kn">import</span> <span class="n">make_slack_blueprint</span><span class="p">,</span> <span class="n">slack</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="s2">&quot;supersekrit&quot;</span>
<span class="n">blueprint</span> <span class="o">=</span> <span class="n">make_slack_blueprint</span><span class="p">(</span>
    <span class="n">client_id</span><span class="o">=</span><span class="s2">&quot;my-key-here&quot;</span><span class="p">,</span>
    <span class="n">client_secret</span><span class="o">=</span><span class="s2">&quot;my-secret-here&quot;</span><span class="p">,</span>
    <span class="n">scope</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;identify&quot;</span><span class="p">,</span> <span class="s2">&quot;chat:write:bot&quot;</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">blueprint</span><span class="p">,</span> <span class="n">url_prefix</span><span class="o">=</span><span class="s2">&quot;/login&quot;</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">slack</span><span class="o">.</span><span class="n">authorized</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;slack.login&quot;</span><span class="p">))</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">slack</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;chat.postMessage&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;channel&quot;</span><span class="p">:</span> <span class="s2">&quot;#general&quot;</span><span class="p">,</span>
        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello, world!&quot;</span><span class="p">,</span>
        <span class="s2">&quot;icon_emoji&quot;</span><span class="p">:</span> <span class="s2">&quot;:robot_face:&quot;</span><span class="p">,</span>
    <span class="p">})</span>
    <span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;ok&quot;</span><span class="p">],</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span>
    <span class="k">return</span> <span class="s1">&#39;I just said &quot;Hello, world!&quot; in the #general channel!&#39;</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You must replace <code class="docutils literal notranslate"><span class="pre">my-key-here</span></code> and <code class="docutils literal notranslate"><span class="pre">my-secret-here</span></code> with the client ID
and client secret that you got from your Slack application.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you are running this code on Heroku, you’ll need to use the
<a class="reference external" href="http://werkzeug.pocoo.org/docs/contrib/fixers/#werkzeug.contrib.fixers.ProxyFix" title="(in Werkzeug v0.14-dev)"><code class="xref py py-class docutils literal notranslate"><span class="pre">werkzeug.contrib.fixers.ProxyFix</span></code></a> middleware. See <a class="reference internal" href="../proxies.html"><span class="doc">Proxies and HTTPS</span></a>.</p>
</div>
<p>When you run this code locally, you must set the
<span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">OAUTHLIB_INSECURE_TRANSPORT</span></code> environment variable for it to work.
You also must set the <span class="target" id="index-1"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">OAUTHLIB_RELAX_TOKEN_SCOPE</span></code> environment variable
to account for Slack changing the requested OAuth scopes on you.
For example, if you put this code in a file named <code class="docutils literal notranslate"><span class="pre">slack.py</span></code>, you could run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">OAUTHLIB_INSECURE_TRANSPORT</span><span class="o">=</span><span class="m">1</span>
$ <span class="nb">export</span> <span class="nv">OAUTHLIB_RELAX_TOKEN_SCOPE</span><span class="o">=</span><span class="m">1</span>
$ python slack.py
</pre></div>
</div>
<p>Visit <a class="reference external" href="http://localhost:5000">http://localhost:5000</a> in your browser, and you should start the OAuth dance
immediately.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><span class="target" id="index-2"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">OAUTHLIB_INSECURE_TRANSPORT</span></code> should only be used for local testing
or over trusted connections. By default, all OAuth interactions must occur
over secure <code class="docutils literal notranslate"><span class="pre">https</span></code> connections (this is enforced by <code class="docutils literal notranslate"><span class="pre">oauthlib</span></code>). However,
setting <span class="target" id="index-3"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">OAUTHLIB_INSECURE_TRANSPORT</span></code> disables this enforcement and
allows OAuth to occur over insecure <code class="docutils literal notranslate"><span class="pre">http</span></code> connections.</p>
<p class="last">However, you can (and probably should) set
<span class="target" id="index-4"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">OAUTHLIB_RELAX_TOKEN_SCOPE</span></code> when running in production.</p>
</div>
</div>
<div class="section" id="explanation">
<h2>Explanation<a class="headerlink" href="#explanation" title="Permalink to this headline">¶</a></h2>
<p>This code makes a <a class="reference external" href="http://flask.pocoo.org/docs/blueprints/#blueprints" title="(in Flask v1.1)"><span class="xref std std-ref">blueprint</span></a> that implements the views
necessary to be a consumer in the <a class="reference internal" href="../how-oauth-works.html"><span class="doc">OAuth dance</span></a>. The
blueprint has two views: <code class="docutils literal notranslate"><span class="pre">/slack</span></code>, which is the view that the user visits
to begin the OAuth dance, and <code class="docutils literal notranslate"><span class="pre">/slack/authorized</span></code>, which is the view that
the user is redirected to at the end of the OAuth dance. Because we set the
<code class="docutils literal notranslate"><span class="pre">url_prefix</span></code> to be <code class="docutils literal notranslate"><span class="pre">/login</span></code>, the end result is that the views are at
<code class="docutils literal notranslate"><span class="pre">/login/slack</span></code> and <code class="docutils literal notranslate"><span class="pre">/login/slack/authorized</span></code>. The second view is the
“Redirect URI” that you must tell Slack about when you create
the application.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">slack</span></code> variable is a <a class="reference external" href="http://docs.python-requests.org/en/latest/api/#requests.Session" title="(in Requests v2.21.0)"><code class="xref py py-class docutils literal notranslate"><span class="pre">requests.Session</span></code></a> instance, which will be
be preloaded with the user’s access token once the user has gone through the
OAuth dance. You can check the <code class="docutils literal notranslate"><span class="pre">slack.authorized</span></code> boolean to determine if
the access token is loaded. Whether the access token is loaded or not,
you can use all the normal <code class="docutils literal notranslate"><span class="pre">requests</span></code> methods, like
<a class="reference external" href="http://docs.python-requests.org/en/latest/api/#requests.Session.get" title="(in Requests v2.21.0)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code></a> and <a class="reference external" href="http://docs.python-requests.org/en/latest/api/#requests.Session.post" title="(in Requests v2.21.0)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">post()</span></code></a>,
to make HTTP requests. If you only specify the Slack method name you want
to call, the rest of the URL will be filled in for you. For example, if
you want to make a request to <code class="docutils literal notranslate"><span class="pre">https://slack.com/api/auth.test</span></code>, you
can simply refer to <code class="docutils literal notranslate"><span class="pre">auth.test</span></code>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Slack Quickstart</a><ul>
<li><a class="reference internal" href="#set-up-the-application">Set up the application</a></li>
<li><a class="reference internal" href="#code">Code</a></li>
<li><a class="reference internal" href="#explanation">Explanation</a></li>
</ul>
</li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Quickstarts</a><ul>
      <li>Previous: <a href="meetup.html" title="previous chapter">Meetup Quickstart</a></li>
      <li>Next: <a href="azure.html" title="next chapter">Azure Quickstart</a></li>
  </ul></li>
  </ul></li>
</ul>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/quickstarts/slack.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

<div class="github">
    <a href="https://github.com/singingwolfboy/flask-dance">
        <span>Fork me on GitHub</span>
        <img src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub">
    </a>
</div>


    
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014-2019, David Baumgold.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.3.
    </div>
    

  </body>
</html>