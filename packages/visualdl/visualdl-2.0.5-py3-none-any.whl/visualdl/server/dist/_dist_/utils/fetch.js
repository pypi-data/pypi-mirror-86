const l={};import O from"../../__snowpack__/env.js";l.env=O;function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?g(Object(n),!0).forEach(function(r){b(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _(e,t){if(e==null)return{};var n=P(e,t),r,o;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++){if(r=i[o],t.indexOf(r)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(e,r))continue;n[r]=e[r]}}return n}function P(e,t){if(e==null)return{};var n={},r=Object.keys(e),o,i;for(i=0;i<r.length;i++){if(o=r[i],t.indexOf(o)>=0)continue;n[o]=e[o]}return n}import v from"../../web_modules/i18next.js";import A from"../../web_modules/query-string.js";const p=l.env.SNOWPACK_PUBLIC_API_TOKEN_KEY,E=l.env.SNOWPACK_PUBLIC_API_URL,m="X-VisualDL-Instance-ID",f=p?A.parse(window.location.search)[p]:"";export function getApiToken(){return f!=null?f:null}function I(e){const t=getApiToken();if(!p||!t)return e;const n=e||{},{headers:r}=n,o=_(n,["headers"]),i=new Headers(r);return Array.isArray(t)?t.forEach(a=>i.append(m,a)):i.append(m,t),y(y({},o),{},{headers:i})}function j(){return new Promise(e=>{v.changeLanguage(void 0).then(t=>e(t))})}function c(e){return l.env.MODE==="development"&&console.error(e),j()}export async function fetcher(e,t){var n;let r;try{r=await fetch(E+e,I(t))}catch(i){const a=await c(i);throw new Error(a("errors:network-error"))}if(!r.ok){const i=await c(r);throw new Error(i([`errors:response-error.${r.status}`,"errors:response-error.unknown"]))}let o;if((n=r.headers.get("content-type"))===null||n===void 0?void 0:n.includes("application/json")){try{o=await r.json()}catch(i){const a=await c(i);throw new Error(a("errors:parse-error"))}if(o&&"status"in o)if(o.status!==0){const i=await c(o);throw new Error(o.msg||i("errors:error"))}else return o.data;return o}else{let i;try{i=await r.blob()}catch(s){const u=await c(s);throw new Error(u("errors:parse-error"))}const a=r.headers.get("Content-Disposition");i.arrayBuffer||(i.arrayBuffer=async()=>new Promise((s,u)=>{const h=new FileReader;h.addEventListener("load",w=>w.target?s(w.target.result):u()),h.readAsArrayBuffer(i)}));let d=null;if(a&&a.indexOf("attachment")!==-1){const s=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(a);s!=null&&s[1]&&(d=s[1].replace(/['"]/g,""))}return{data:i,type:r.headers.get("Content-Type"),filename:d}}}export const cycleFetcher=async(e,t)=>await Promise.all(e.map(n=>fetcher(n,t)));
