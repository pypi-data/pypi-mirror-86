function l(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),i.push.apply(i,s)}return i}function u(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?l(Object(i),!0).forEach(function(s){r(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}export class AudioPlayer{get current(){return this.playing?this.context.currentTime-this.startAt+this.offset:this.offset}get duration(){return this.buffer?this.buffer.duration:Number.NaN}get sampleRate(){return this.buffer?this.decodedSampleRate:Number.NaN}get volume(){return this.gain.gain.value*100}set volume(e){e>100?e=100:e<0&&(e=0),this.gain.gain.value=e/100}constructor(e){var t;r(this,"context",void 0),r(this,"gain",void 0),r(this,"source",null),r(this,"buffer",null),r(this,"decodedSampleRate",Number.NaN),r(this,"contextFromOptions",void 0),r(this,"startAt",0),r(this,"stopAt",0),r(this,"offset",0),r(this,"toggleVolume",100),r(this,"playing",!1),r(this,"options",void 0),this.options=u({context:(t=e==null?void 0:e.context)!==null&&t!==void 0?t:new AudioContext,volume:100,onplay:()=>{},onstop:()=>{}},e),this.contextFromOptions=!!(e==null?void 0:e.context),this.context=this.options.context,this.gain=this.context.createGain(),this.volume=this.options.volume}reset(){if(this.buffer){if(this.playing){var e;(e=this.source)===null||e===void 0||e.stop(0)}this.startAt=0,this.stopAt=0,this.offset=0,this.buffer=null}}static getWavSampleRate(e){const t=new Int8Array(e),i=t.slice(24,28);return i[0]&255|(i[1]&255)<<8|(i[2]&255)<<16|(i[3]&255)<<24}static getMp3SampleRate(e){let t=new Uint8Array(e);if(String.fromCharCode.apply(null,Array.from(t.slice(0,3)))==="ID3"){t=t.slice(10);let a=0;for(;t[a]!==0;){const h=t[a+4]*4294967296+t[a+5]*65536+t[a+6]*256+t[a+7];a+=10+h}}let i=0;for(;t[i++]!==255;);i--;const s=t.slice(i,i+4),o=(s[1]&24)>>3,n=(s[2]&12)>>2;if(o===3){if(n===0)return 44100;if(n===1)return 48e3;if(n===2)return 32e3}else if(o===2){if(n===0)return 22050;if(n===1)return 24e3;if(n===2)return 16e3}else if(o===0){if(n===0)return 11025;if(n===1)return 12e3;if(n===2)return 8e3}return Number.NaN}load(e,t){return this.reset(),t==="wav"?this.decodedSampleRate=AudioPlayer.getWavSampleRate(e):t==="mpga"||t==="mp3"?this.decodedSampleRate=AudioPlayer.getMp3SampleRate(e):this.decodedSampleRate=Number.NaN,new Promise((i,s)=>{this.context.decodeAudioData(e,o=>{this.buffer=o,i()},s)})}play(){if(!this.buffer)throw new Error("No audio loaded");this.source=this.context.createBufferSource(),this.source.buffer=this.buffer,this.source.connect(this.gain).connect(this.context.destination),this.source.addEventListener("ended",()=>{this.stopAt=this.context.currentTime,this.offset+=this.stopAt-this.startAt,this.playing=!1,this.options.onstop(),this.source=null}),this.offset>=this.duration&&(this.offset=0),this.source.start(0,this.offset),this.startAt=this.context.currentTime,this.playing=!0,this.options.onplay()}pause(){var e;if(!this.buffer)throw new Error("No audio loaded");(e=this.source)===null||e===void 0||e.stop(0)}toggle(){this.playing?this.pause():this.play()}stop(){this.pause(),this.startAt=0,this.stopAt=0,this.offset=0}seek(e){if(e!=null&&(e<0||e>this.duration))throw new Error("Invalid offset");this.offset=e}toggleMute(){this.volume===0?this.volume=this.toggleVolume||100:(this.toggleVolume=this.volume,this.volume=0)}dispose(){this.reset(),this.contextFromOptions||this.context.close(),this.source=null,this.buffer=null}}
