import y,{AsideSection as s}from"../components/Aside.js";import se from"../components/GraphPage/Graph.js";import e,{useCallback as i,useEffect as H,useMemo as x,useRef as q,useState as r}from"../../web_modules/react.js";import ie from"../components/Select.js";import{actions as ce,selectors as _e}from"../store/index.js";import{primaryColor as pe,rem as c,size as me}from"../utils/style.js";import{useDispatch as de,useSelector as ue}from"../../web_modules/react-redux.js";import j from"../components/Button.js";import N from"../components/Checkbox.js";import he from"../components/Content.js";import f from"../components/Field.js";import ge from"../../web_modules/react-spinners/HashLoader.js";import Ee from"../components/GraphPage/ModelPropertiesDialog.js";import fe from"../components/GraphPage/NodeDocumentationSidebar.js";import Re from"../components/GraphPage/NodePropertiesSidebar.js";import Y from"../components/RadioButton.js";import Pe from"../components/RadioGroup.js";import ve from"../components/GraphPage/Search.js";import we from"../components/Title.js";import Ue from"../components/GraphPage/Uploader.js";import _ from"../../web_modules/styled-components.js";import Se from"../hooks/useRequest.js";import{useTranslation as be}from"../../web_modules/react-i18next.js";const K=_(j).withConfig({displayName:"graph__FullWidthButton",componentId:"sc-1v5tw03-0"})(["width:100%;"]),Ce=_(ie).withConfig({displayName:"graph__FullWidthSelect",componentId:"sc-1v5tw03-1"})(["width:100%;"]),ye=_.div.withConfig({displayName:"graph__ExportButtonWrapper",componentId:"sc-1v5tw03-2"})(["display:flex;justify-content:space-between;> *{flex:1 1 auto;&:not(:last-child){margin-right:",";}}"],c(20)),xe=_(s).withConfig({displayName:"graph__SearchSection",componentId:"sc-1v5tw03-3"})(["max-height:calc(100% - ",");display:flex;flex-direction:column;&:not(:last-child){padding-bottom:0;}"],c(40)),je=_.div.withConfig({displayName:"graph__Loading",componentId:"sc-1v5tw03-4"})([""," display:flex;flex-direction:column;justify-content:center;align-items:center;overscroll-behavior:none;cursor:progress;font-size:",";line-height:",";"],me("100%","100%"),c(16),c(60)),Ne=()=>{const{t:n}=be(["graph","common"]),D=de(),V=ue(_e.graph.model),a=q(null),p=q(null),[R,P]=r(V),m=i(()=>{p.current&&(p.current.value="",p.current.click())},[]),J=i(t=>{const o=t.target;o&&o.files&&o.files.length&&(D(ce.graph.setModel(o.files)),P(o.files))},[D]),{data:l,loading:v}=Se(R?null:"/graph/graph");H(()=>{(l==null?void 0:l.data.size)&&P([new File([l.data],l.filename||"unknown_model")])},[l]);const[w,Q]=r([]),[G,I]=r(""),X=i(t=>{Q(t.graphs),I(t.selected||"")},[]),A=i(t=>{var o;I(t),(o=a.current)===null||o===void 0||o.changeGraph(t)},[]),[F,U]=r(""),[d,L]=r(!1),[k,z]=r({text:"",result:[]}),B=i(t=>{var o;U(t),(o=a.current)===null||o===void 0||o.search(t)},[]),M=i(t=>{var o;U(t.name),(o=a.current)===null||o===void 0||o.select(t)},[]),[u,Z]=r(!1),[h,ee]=r(!0),[g,te]=r(!1),[S,oe]=r(!1),[ne,O]=r(null),[E,T]=r(null),[b,C]=r(null);H(()=>{U(""),z({text:"",result:[]})},[R,u,h,g]);const W=x(()=>d?null:e.createElement(K,{type:"primary",rounded:!0,onClick:m},n("graph:change-model")),[n,m,d]),[$,re]=r(!1),ae=x(()=>!$||v?null:b?e.createElement(y,{width:c(360)},e.createElement(fe,{data:b,onClose:()=>C(null)})):E?e.createElement(y,{width:c(360)},e.createElement(Re,{data:E,onClose:()=>T(null),showNodeDocumentation:()=>{var t;return(t=a.current)===null||t===void 0?void 0:t.showNodeDocumentation(E)}})):e.createElement(y,{bottom:W},e.createElement(xe,null,e.createElement(ve,{text:F,data:k,onChange:B,onSelect:M,onActive:()=>L(!0),onDeactive:()=>L(!1)})),!d&&e.createElement(e.Fragment,null,e.createElement(s,null,e.createElement(K,{onClick:()=>{var t;return(t=a.current)===null||t===void 0?void 0:t.showModelProperties()}},n("graph:model-properties"))),w.length>1&&e.createElement(s,null,e.createElement(f,{label:n("graph:subgraph")},e.createElement(Ce,{list:w,value:G,onChange:A}))),e.createElement(s,null,e.createElement(f,{label:n("graph:display-data")},e.createElement("div",null,e.createElement(N,{value:u,onChange:Z},n("graph:show-attributes"))),e.createElement("div",null,e.createElement(N,{value:h,onChange:ee},n("graph:show-initializers"))),e.createElement("div",null,e.createElement(N,{value:g,onChange:te},n("graph:show-node-names"))))),e.createElement(s,null,e.createElement(f,{label:n("graph:direction")},e.createElement(Pe,{value:S,onChange:oe},e.createElement(Y,{value:!1},n("graph:vertical")),e.createElement(Y,{value:!0},n("graph:horizontal"))))),e.createElement(s,null,e.createElement(f,{label:n("graph:export-file")},e.createElement(ye,null,e.createElement(j,{onClick:()=>{var t;return(t=a.current)===null||t===void 0?void 0:t.export("png")}},n("graph:export-png")),e.createElement(j,{onClick:()=>{var t;return(t=a.current)===null||t===void 0?void 0:t.export("svg")}},n("graph:export-svg"))))))),[n,W,F,d,k,w,G,A,B,M,u,h,g,S,$,v,E,b]),le=x(()=>e.createElement(Ue,{onClickUpload:m,onDropFiles:P}),[m]);return e.createElement(e.Fragment,null,e.createElement(we,null,n("common:graph")),e.createElement(Ee,{data:ne,onClose:()=>O(null)}),e.createElement(he,{aside:ae},v?e.createElement(je,null,e.createElement(ge,{size:"60px",color:pe})):e.createElement(se,{ref:a,files:R,uploader:le,showAttributes:u,showInitializers:h,showNames:g,horizontal:S,onRendered:()=>re(!0),onOpened:X,onSearch:t=>z(t),onShowModelProperties:t=>O(t),onShowNodeProperties:t=>{T(t),C(null)},onShowNodeDocumentation:t=>C(t)}),e.createElement("input",{ref:p,type:"file",multiple:!1,onChange:J,style:{display:"none"}})))};export default Ne;
