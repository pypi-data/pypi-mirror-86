function y(){return y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},y.apply(this,arguments)}function F(e,t){if(e==null)return{};var r=N(e,t),n,s;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(s=0;s<p.length;s++){if(n=p[s],t.indexOf(n)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(e,n))continue;r[n]=e[n]}}return r}function N(e,t){if(e==null)return{};var r={},n=Object.keys(e),s,p;for(p=0;p<n.length;p++){if(s=n[p],t.indexOf(s)>=0)continue;r[s]=e[s]}return r}function T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?T(Object(r),!0).forEach(function(n){W(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function W(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}import D from"../components/ChartPage.js";import a,{useCallback as I,useEffect as q,useMemo as P,useState as j}from"../../web_modules/react.js";import{rem as x,transitionProps as k}from"../utils/style.js";import{AsideSection as E}from"../components/Aside.js";import M from"../components/Content.js";import B from"../components/Error.js";import K from"../components/Field.js";import Y from"../components/PRCurvePage/PRCurveChart.js";import H from"../components/RunAside.js";import V from"../components/PRCurvePage/StepSlider.js";import z from"../components/TimeModeSelect.js";import{TimeType as G}from"../resource/pr-curve/index.js";import J from"../components/Title.js";import{cycleFetcher as Q}from"../utils/fetch.js";import X from"../../web_modules/query-string.js";import Z from"../../web_modules/styled-components.js";import{useRunningRequest as ee}from"../hooks/useRequest.js";import te from"../hooks/useTagFilter.js";import{useTranslation as ne}from"../../web_modules/react-i18next.js";const re=Z.div.withConfig({displayName:"pr-curve__StepSliderWrapper",componentId:"sc-2ui709-0"})(["max-height:30vh;overflow:auto;overflow-x:hidden;overflow-y:auto;flex-shrink:0;> ",":last-child{padding-bottom:",";margin-bottom:0;}+ .run-section{border-top:1px solid var(--border-color);margin-top:0;padding-top:",";","}&:empty + .run-section{border-top:none;}"],E,x(20),x(20),k("border-color")),oe=()=>{const{t:e}=ne(["pr-curve","common"]),[t,r]=j(!0),{runs:n,tags:s,runsInTags:p,selectedRuns:R,onChangeRuns:O,loading:g}=te("pr-curve",t),[w,S]=j({}),C=I((o,i)=>S(u=>m(m({},u),{},{[o]:i})),[]);q(()=>S(o=>p.reduce((i,u)=>(o[u.label]!=null&&(i[u.label]=o[u.label]),i),{})),[p]);const{data:l}=ee(p.map(o=>`/pr-curve/steps?${X.stringify({run:o.label})}`),!!t,(...o)=>Q(o)),f=P(()=>p.map((o,i)=>{var u,c,h,b,v;return m(m({},o),{},{index:(u=w[o.label])!==null&&u!==void 0?u:((c=l==null?void 0:l[i].length)!==null&&c!==void 0?c:1)-1,steps:(h=l==null?void 0:l[i].map(d=>d[1]))!==null&&h!==void 0?h:[],wallTimes:(b=l==null?void 0:l[i].map(d=>Math.floor(d[0])))!==null&&b!==void 0?b:[],relatives:(v=l==null?void 0:l[i].map(d=>d[0]-l[i][0][0]))!==null&&v!==void 0?v:[]})}),[p,l,w]),[_,U]=j(G.Step),A=P(()=>s.map(o=>m(m({},o),{},{runs:o.runs.map(i=>m(m({},i),{},{index:0,steps:[],wallTimes:[],relatives:[]},f.find(u=>u.label===i.label)))})),[s,f]),$=P(()=>n.length?a.createElement(H,{runs:n,selectedRuns:R,onChangeRuns:O,running:t,onToggleRunning:r},a.createElement(E,null,a.createElement(K,{label:e("pr-curve:time-display-type")},a.createElement(z,{value:_,onChange:U}))),a.createElement(re,null,f.map(o=>a.createElement(E,{key:o.label},a.createElement(V,{run:o,type:_,onChange:i=>C(o.label,i)}))))):null,[e,O,t,n,R,_,f,C]),L=I(o=>{let{label:i,runs:u}=o,c=F(o,["label","runs"]);return a.createElement(Y,y({runs:u,tag:i},c,{running:t}))},[t]);return a.createElement(a.Fragment,null,a.createElement(J,null,e("common:pr-curve")),a.createElement(M,{aside:$,loading:g},!g&&!n.length?a.createElement(B,null):a.createElement(D,{items:A,withChart:L,loading:g})))};export default oe;
