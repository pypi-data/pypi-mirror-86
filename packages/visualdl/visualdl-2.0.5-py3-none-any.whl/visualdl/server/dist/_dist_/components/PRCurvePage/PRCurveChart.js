function x(r,t){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(r,o).enumerable})),i.push.apply(i,n)}return i}function f(r){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?x(Object(i),!0).forEach(function(n){M(r,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):x(Object(i)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(i,n))})}return r}function M(r,t,i){return t in r?Object.defineProperty(r,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[t]=i,r}import W from"../LineChart.js";import m,{useCallback as P,useMemo as _,useRef as B,useState as K}from"../../../web_modules/react.js";import{options as R,nearestPoint as Y}from"../../resource/pr-curve/index.js";import{rem as w,size as S}from"../../utils/style.js";import H from"../ChartToolbox.js";import V from"../TooltipTable.js";import{cycleFetcher as G}from"../../utils/fetch.js";import J from"../../utils/event.js";import{format as E}from"../../../web_modules/d3-format.js";import Q from"../../../web_modules/query-string.js";import{renderToStaticMarkup as X}from"../../../web_modules/react-dom/server.js";import h from"../../../web_modules/styled-components.js";import{useRunningRequest as Z}from"../../hooks/useRequest.js";import{useTranslation as ee}from"../../../web_modules/react-i18next.js";import te from"../../../web_modules/lodash/zip.js";const T=E(".4f"),re=E(".2f"),oe=h.div.withConfig({displayName:"PRCurveChart__Wrapper",componentId:"b2l3cc-0"})([""," display:flex;flex-direction:column;align-items:stretch;justify-content:space-between;"],S("100%","100%")),ie=h(W).withConfig({displayName:"PRCurveChart__StyledLineChart",componentId:"b2l3cc-1"})(["flex-grow:1;"]),ne=h(H).withConfig({displayName:"PRCurveChart__Toolbox",componentId:"b2l3cc-2"})(["margin-left:",";margin-right:",";margin-bottom:",";"],w(20),w(20),w(18)),ae=h.div.withConfig({displayName:"PRCurveChart__Error",componentId:"b2l3cc-3"})([""," display:flex;justify-content:center;align-items:center;"],S("100%","100%")),se=({cid:r,runs:t,tag:i,running:n})=>{const{t:o}=ee(["pr-curve","common"]),v=B(null),{data:p,error:I,loading:z}=Z(t.map(e=>`/pr-curve/list?${Q.stringify({run:e.label,tag:i})}`),!!n,(...e)=>G(e)),[C,L]=K(!1),A=P(()=>{J.emit("toggle-chart-size",r,!C),L(e=>!e)},[r,C]),d=_(()=>t.map((e,l)=>{var a,c;const[b,g,...s]=(a=p==null||((c=p[l])===null||c===void 0)?void 0:c.find(u=>u[1]===e.steps[e.index]))!==null&&a!==void 0?a:[0,0,[],[],[],[],[],[],[]];return[b,g,te(...s)]}),[p,t]),j=_(()=>d.map((e,l)=>{const a=t[l];return{name:a.label,z:l,itemStyle:{color:a.colors[0]},lineStyle:{color:a.colors[0]},data:e[2],encode:{x:[1],y:[0]}}}),[d,t]),O=P(e=>{const l=Array.isArray(e)?e[0].data:e.data,a=Y(d.map(s=>s[2]),l[1]),c=[{label:o("pr-curve:threshold")},{label:o("pr-curve:precision")},{label:o("pr-curve:recall")},{label:o("pr-curve:true-positives")},{label:o("pr-curve:false-positives")},{label:o("pr-curve:true-negatives")},{label:o("pr-curve:false-negatives")}],b=a.reduce((s,u,y)=>(s.push(...new Array(u.length).fill(t[y])),s),[]),g=a.reduce((s,u)=>(s.push(...u.map(([y,D,U,$,q,k,F])=>[re(F),T(y),T(D),U,$,q,k])),s),[]);return X(m.createElement(V,{run:o("common:runs"),runs:b,columns:c,data:g}))},[d,t,o]),N=_(()=>f(f({},R),{},{tooltip:f(f({},R.tooltip),{},{formatter:O,hideDelay:300,enterable:!0})}),[O]);return!j&&I?m.createElement(ae,null,o("common:error")):m.createElement(oe,null,m.createElement(ie,{ref:v,title:i,options:N,data:j,loading:z,zoom:!0}),m.createElement(ne,{items:[{icon:"maximize",activeIcon:"minimize",tooltip:o("pr-curve:maximize"),activeTooltip:o("pr-curve:minimize"),toggle:!0,onClick:A},{icon:"restore-size",tooltip:o("pr-curve:restore"),onClick:()=>{var e;return(e=v.current)===null||e===void 0?void 0:e.restore()}},{icon:"download",tooltip:o("pr-curve:download-image"),onClick:()=>{var e;return(e=v.current)===null||e===void 0?void 0:e.saveAsImage()}}]}))};export default se;
