function M(r,t){var n=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),n.push.apply(n,a)}return n}function l(r){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?M(Object(n),!0).forEach(function(a){ie(r,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(n,a))})}return r}function ie(r,t,n){return t in r?Object.defineProperty(r,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[t]=n,r}import le,{XAxisType as p,YAxisType as y}from"../LineChart.js";import f,{useCallback as x,useMemo as c,useRef as ce,useState as q}from"../../../web_modules/react.js";import{XAxis as me,axisRange as de,chartData as ue,options as Y,nearestPoint as pe,range as fe,singlePointRange as $,sortingMethodMap as ge,tooltip as he,transform as ye,xAxisMap as F}from"../../resource/scalar/index.js";import{rem as j,size as H}from"../../utils/style.js";import _e from"../ChartToolbox.js";import be from"../TooltipTable.js";import{cycleFetcher as ve}from"../../utils/fetch.js";import we from"../../utils/event.js";import{format as xe}from"../../../web_modules/d3-format.js";import je from"../../../web_modules/query-string.js";import{renderToStaticMarkup as Oe}from"../../../web_modules/react-dom/server.js";import _ from"../../../web_modules/styled-components.js";import O from"../../hooks/useHeavyWork.js";import{useRunningRequest as Ce}from"../../hooks/useRequest.js";import{useTranslation as Se}from"../../../web_modules/react-i18next.js";import C from"../../utils/wasm.js";const Re=xe(".8"),Te=()=>C("scalar_transform").then(r=>t=>r(t.datasets,t.smoothing)),Pe=()=>C("scalar_axis_range").then(r=>t=>r(t.datasets,t.outlier)),Ee=()=>C("scalar_range").then(r=>t=>r(t.datasets)),ke=_.div.withConfig({displayName:"ScalarChart__Wrapper",componentId:"sc-1caty5y-0"})([""," display:flex;flex-direction:column;align-items:stretch;justify-content:space-between;"],H("100%","100%")),Ie=_(le).withConfig({displayName:"ScalarChart__StyledLineChart",componentId:"sc-1caty5y-1"})(["flex-grow:1;"]),Le=_(_e).withConfig({displayName:"ScalarChart__Toolbox",componentId:"sc-1caty5y-2"})(["margin-left:",";margin-right:",";margin-bottom:",";"],j(20),j(20),j(18)),We=_.div.withConfig({displayName:"ScalarChart__Error",componentId:"sc-1caty5y-3"})([""," display:flex;justify-content:center;align-items:center;"],H("100%","100%")),Ae=({cid:r,runs:t,tag:n,smoothing:a,xAxis:i,sortingMethod:S,outlier:R,smoothedOnly:T,showMostValue:P,running:B})=>{const{t:m,i18n:E}=Se(["scalar","common"]),b=ce(null),{data:g,error:K,loading:X}=Ce(t.map(e=>`/scalar/list?${je.stringify({run:e.label,tag:n})}`),!!B,(...e)=>ve(e)),[k,G]=q(!1),J=x(()=>{we.emit("toggle-chart-size",r,!k),G(e=>!e)},[r,k]),u=c(()=>i===me.WallTime?p.time:p.value,[i]),[I,L]=q(y.value),Q=x(()=>{L(e=>e===y.log?y.value:y.log)},[L]),V=c(()=>{var e;return{datasets:(e=g==null?void 0:g.map(s=>s!=null?s:[]))!==null&&e!==void 0?e:[],smoothing:a}},[g,a]),h=O(Te,null,ye,V),o=c(()=>h!=null?h:[],[h]),Z=c(()=>({datasets:o,outlier:!!R}),[o,R]),W=O(Pe,null,de,Z),ee=c(()=>({datasets:o}),[o]),d=O(Ee,null,fe,ee),v=c(()=>{let e,s=W;return o.length===1&&o[0].length===1&&([p.value,p.log].includes(u)&&(e=$(o[0][0][F[i]])),s=$(o[0][0][2])),{x:e,y:s}},[o,W,u,i]),A=c(()=>ue({data:o.slice(0,t.length),ranges:P?d!=null?d:[]:[],runs:t,xAxis:i,smoothedOnly:T}),[o,d,t,i,T,P]),z=c(()=>String(Math.max(...o.map(e=>Math.max(...e.map(s=>s[1]))))).length,[o]),D=x(e=>{const s=Array.isArray(e)?e[0].data:e.data,N=F[i],re=pe(o!=null?o:[],t,N,s[N]).map((w,se)=>l(l({},w),d==null?void 0:d[se])),oe=ge[S],U=oe(re,s),{columns:ne,data:ae}=he(U,z,E);return Oe(f.createElement(be,{run:m("common:runs"),runs:U.map(w=>w.run),columns:ne,data:ae}))},[o,d,t,S,i,z,m,E]),te=c(()=>l(l({},Y),{},{tooltip:l(l({},Y.tooltip),{},{formatter:D,hideDelay:300,enterable:!0}),xAxis:l(l({type:u},v.x),{},{axisPointer:{label:{formatter:u===p.time?void 0:({value:e})=>Re(e)}}}),yAxis:l({type:I},v.y)}),[D,v,u,I]);return!A&&K?f.createElement(We,null,m("common:error")):f.createElement(ke,null,f.createElement(Ie,{ref:b,title:n,options:te,data:A,loading:X,zoom:!0}),f.createElement(Le,{items:[{icon:"maximize",activeIcon:"minimize",tooltip:m("scalar:maximize"),activeTooltip:m("scalar:minimize"),toggle:!0,onClick:J},{icon:"restore-size",tooltip:m("scalar:restore"),onClick:()=>{var e;return(e=b.current)===null||e===void 0?void 0:e.restore()}},{icon:"log-axis",tooltip:m("scalar:toggle-log-axis"),toggle:!0,onClick:Q},{icon:"download",tooltip:m("scalar:download-image"),onClick:()=>{var e;return(e=b.current)===null||e===void 0?void 0:e.saveAsImage()}}]}))};export default Ae;
