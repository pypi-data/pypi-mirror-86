import o,{useCallback as n,useEffect as x,useMemo as X,useRef as U,useState as l}from"../../web_modules/react.js";import{primaryColor as G,rem as r,size as h,transitionProps as s}from"../utils/style.js";import{AudioPlayer as J}from"../utils/audio.js";import A from"./Icon.js";import Q from"../../web_modules/react-spinners/PuffLoader.js";import Z from"./RangeSlider.js";import ee from"../../web_modules/react-rangeslider.js";import re from"../../web_modules/react-spinners/SyncLoader.js";import te from"../../web_modules/@tippyjs/react.js";import oe from"../../web_modules/mime-types.js";import ne from"../../web_modules/moment.js";import N from"../../web_modules/styled-components.js";import{useTranslation as ie}from"../../web_modules/react-i18next.js";const le=N.div.withConfig({displayName:"Audio__Container",componentId:"sc-6r7be3-0"})(["background-color:var(--audio-background-color);border-radius:",";display:flex;align-items:center;justify-content:space-between;padding:0 ",";"," > .control{font-size:",";"," line-height:1;margin:0 ",";color:var(--primary-color);cursor:pointer;"," &.volume{font-size:",";","}&.disabled{color:var(--text-light-color);cursor:not-allowed;}&:hover{color:var(--primary-focused-color);}&:active{color:var(--primary-active-color);}}> .slider{flex-grow:1;padding:0 ",";}> .time{color:var(--text-lighter-color);font-size:",";margin:0 ",";","}"],r(8),r(20),s("background-color"),r(16),h(r(16),r(16)),r(10),s("color"),r(20),h(r(20),r(20)),r(10),r(12),r(5),s("color")),ae=N(ee).withConfig({displayName:"Audio__VolumeSlider",componentId:"sc-6r7be3-1"})(["margin:"," ",";width:",";height:",";cursor:pointer;position:relative;background-color:#dbdeeb;outline:none;border-radius:",";user-select:none;"," --color:var(--primary-color);&:hover{--color:var(--primary-focused-color);}&:active{--color:var(--primary-active-color);}.rangeslider__fill{background-color:var(--color);position:absolute;bottom:0;width:100%;border-bottom-left-radius:",";border-bottom-right-radius:",";border-top:"," solid var(--color);box-sizing:content-box;","}.rangeslider__handle{background-color:var(--color);"," position:absolute;left:-",";border-radius:50%;outline:none;"," .rangeslider__handle-tooltip,.rangeslider__handle-label{display:none;}}.rangeslider__labels{display:none;}"],r(15),r(18),r(4),r(100),r(2),s("color"),r(2),r(2),r(4),s(["background-color","color"]),h(r(8),r(8)),r(2),s("background-color")),w=100;function L(u){const i=ne.duration(u,"seconds");return String(Math.floor(i.asMinutes())).padStart(2,"0")+":"+String(i.seconds()).padStart(2,"0")}const se=({audioContext:u,data:i,loading:T,error:z,onLoading:d,onLoad:m,className:M})=>{const{t:O}=ie("common"),p=U(null),t=U(null),[D,f]=l(0),[_,g]=l(0),[V,E]=l("00:00"),[v,S]=l(!1),[b,y]=l(!1),[a,R]=l(100),[P,$]=l(!1),k=n(()=>{var e;return(e=t.current)===null||e===void 0?void 0:e.play()},[]),I=n(()=>{var e;return(e=t.current)===null||e===void 0?void 0:e.pause()},[]),B=n(()=>{var e;return(e=t.current)===null||e===void 0?void 0:e.toggle()},[]),W=n(e=>{if(!t.current)return;g(e/w*t.current.duration),f(e)},[]),Y=n(()=>{$(b),I()},[b,I]),q=n(()=>{if(!t.current)return;t.current.seek(_),P&&_<t.current.duration&&k()},[k,_,P]),F=n(()=>{t.current&&(t.current.toggleMute(),R(t.current.volume))},[]),c=n(()=>{if(t.current){const e=t.current.current;g(e),f(Math.floor(e/t.current.duration*w))}},[]),C=n(()=>{c(),p.current=window.setInterval(c,250)},[c]),j=n(()=>{t.current&&(t.current.current>=t.current.duration&&c()),p.current&&(window.clearInterval(p.current),p.current=null)},[c]);x(()=>{t.current&&(t.current.volume=a)},[a]),x(()=>{let e=null;return i&&(async()=>{S(!0),d==null||d(),g(0),f(0),E("00:00"),e=new J({context:u,onplay:()=>{y(!0),C()},onstop:()=>{y(!1),j()}});const K=await i.data.arrayBuffer();await e.load(K,i.type!=null&&oe.extension(i.type)||void 0),S(!1),E(L(e.duration)),m==null||m({sampleRate:e.sampleRate,duration:e.duration}),t.current=e})(),()=>{e&&(y(!1),e.dispose(),t.current=null)}},[i,C,j,d,m,u]);const H=X(()=>a===0?"mute":a<=50?"volume-low":"volume",[a]);return T?o.createElement(re,{color:G,size:"15px"}):z?o.createElement("div",null,O("common:error")):o.createElement(le,{className:M},o.createElement("a",{className:`control ${v?"disabled":""}`,onClick:B},v?o.createElement(Q,{size:"16px"}):o.createElement(A,{type:b?"pause":"play"})),o.createElement("div",{className:"slider"},o.createElement(Z,{min:0,max:w,step:1,value:D,disabled:v,onChange:W,onChangeStart:Y,onChangeComplete:q})),o.createElement("span",{className:"time"},L(_),"/",V),o.createElement(te,{placement:"top",animation:"shift-away-subtle",interactive:!0,hideOnClick:!1,content:o.createElement(ae,{value:a,min:0,max:100,step:1,onChange:R,orientation:"vertical"})},o.createElement("a",{className:"control volume",onClick:F},o.createElement(A,{type:H}))))};export default se;
