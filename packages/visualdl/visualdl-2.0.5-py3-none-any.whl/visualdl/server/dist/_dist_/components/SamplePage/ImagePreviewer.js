import t,{useCallback as g,useEffect as p,useLayoutEffect as ee,useMemo as te,useRef as q,useState as s}from"../../../web_modules/react.js";import{em as C,headerHeight as k,primaryColor as ne,rem as u,zIndexes as ie}from"../../utils/style.js";import re from"../../../web_modules/react-spinners/GridLoader.js";import m from"../Icon.js";import oe from"../RangeSlider.js";import j from"../../../web_modules/styled-components.js";import{useTranslation as le}from"../../../web_modules/react-i18next.js";const ae=j.div.withConfig({displayName:"ImagePreviewer__Wrapper",componentId:"sc-1n154z7-0"})(["position:fixed;top:0;left:0;z-index:",";height:100vh;width:100vw;background-color:var(--sample-preview-mask-color);"],ie.dialog),se=j.div.withConfig({displayName:"ImagePreviewer__Header",componentId:"sc-1n154z7-1"})(["position:relative;height:",";width:100%;background-color:var(--model-header-background-color);display:flex;justify-content:space-between;align-items:center;.step-slider{display:flex;align-items:center;flex-grow:1;margin:0 ",";.slider{width:31.7213115%;margin:0 ",";}.step-buttons{margin-left:",";display:flex;flex-direction:column;font-size:",";> a{display:inline-block;line-height:1;height:",";&:hover{color:var(--text-lighter-color);}> i{display:inline-block;height:100%;> svg{vertical-align:top;}}}}}.buttons{display:flex;align-items:center;font-size:",";> *{margin-right:",";}> a{height:",";overflow:hidden;}> span{width:1px;height:",";background-color:var(--border-color);}}"],k,u(20),u(12),C(10),C(10),C(14),u(24),u(30),u(24),u(30)),ce=j.div.withConfig({displayName:"ImagePreviewer__Container",componentId:"sc-1n154z7-2"})(["display:flex;justify-content:center;align-items:center;position:absolute;height:calc(100% - ",");width:100%;top:",";left:0;overflow:hidden;> img{cursor:",";}"],k,k,_=>_.grabbing?"grabbing":"grab"),b=3,y=.1,de=({data:_,loading:N,error:A,steps:v,step:c,onClose:S,onChange:f,onChangeComplete:F})=>{const{t:U}=le("sample"),[l,z]=s(c!=null?c:0);p(()=>z(c!=null?c:0),[c]);const h=g(e=>{z(e),f==null||f(e)},[f]),K=g(()=>{l>0&&h(l-1)},[l,h]),V=g(()=>{l<v.length-1&&h(l+1)},[l,v,h]),[d,J]=s("");ee(()=>{if(_){let e=null;return e=URL.createObjectURL(_.data),J(e),()=>{e&&URL.revokeObjectURL(e)}}},[_]);const P=q(null),H=q(null),[W,E]=s(0),[O,w]=s(0);p(()=>{if(d){const e=new Image;e.src=d,e.onload=()=>{var i;const n=(i=P.current)===null||i===void 0?void 0:i.getBoundingClientRect();if(n){const a=n.width/n.height,r=e.naturalWidth/e.naturalHeight;a>=r&&e.naturalHeight>n.height*.9?(w(n.height*.9),E(r*n.height*.9)):r>=a&&e.naturalWidth>n.width*.9?(E(n.width*.9),w(r*n.width*.9)):(E(e.naturalWidth),w(e.naturalHeight))}}}return()=>{E(0),w(0)}},[d]);const[Y,L]=s(1),D=g(e=>L(i=>i+e>b?b:i+e<y?y:i+e),[]);p(()=>{const e=P.current,i=n=>{n.preventDefault(),L(a=>{const r=a-n.deltaY*.007;return r>b?b:r<y?y:r})};return e==null||e.addEventListener("wheel",i),()=>{e==null||e.removeEventListener("wheel",i)}},[]);const[Q,G]=s(!1),[M,T]=s(0),[X,$]=s(0);p(()=>{const e=H.current;let i=!1,n=0,a=0;const r=o=>{o.preventDefault(),G(!0),i=!0,n=o.clientX,a=o.clientY},B=o=>{o.preventDefault(),i&&(T(x=>x+(o.clientX-n)),$(x=>x+(o.clientY-a)),n=o.clientX,a=o.clientY)},R=()=>{G(!1),i=!1};return e==null||e.addEventListener("mousedown",r),e==null||e.addEventListener("mousemove",B),e==null||e.addEventListener("mouseup",R),e==null||e.addEventListener("mouseout",R),()=>{e==null||e.removeEventListener("mousedown",r),e==null||e.removeEventListener("mousemove",B),e==null||e.removeEventListener("mouseup",R),e==null||e.removeEventListener("mouseout",R)}},[d]);const I=g(()=>{L(1),T(0),$(0)},[]);p(()=>I,[d,I]);const Z=te(()=>N?t.createElement(re,{color:ne,size:"10px"}):A?t.createElement("div",null,U("common:error")):t.createElement("img",{src:d,ref:H,onClick:e=>e.stopPropagation(),style:{width:W,height:O,transform:`translate(${M}px, ${X}px) scale(${Y})`}}),[d,N,A,W,O,M,X,Y,U]);return t.createElement(ae,null,t.createElement(se,null,t.createElement("div",{className:"step-slider"},t.createElement("span",null,U("sample:step")),t.createElement(oe,{className:"slider",min:0,max:v.length?v.length-1:0,step:1,value:l,onChange:h,onChangeComplete:F}),t.createElement("span",null,v[l]),t.createElement("div",{className:"step-buttons"},t.createElement("a",{href:"javascript:void(0)",onClick:K},t.createElement(m,{type:"chevron-up"})),t.createElement("a",{href:"javascript:void(0)",onClick:V},t.createElement(m,{type:"chevron-down"})))),t.createElement("div",{className:"buttons"},t.createElement("a",{href:"javascript:void(0)",onClick:()=>D(.1)},t.createElement(m,{type:"plus-circle"})),t.createElement("a",{href:"javascript:void(0)",onClick:()=>D(-.1)},t.createElement(m,{type:"minus-circle"})),t.createElement("a",{href:"javascript:void(0)",onClick:I},t.createElement(m,{type:"restore-circle"})),t.createElement("span",null),t.createElement("a",{href:"javascript:void(0)",onClick:S},t.createElement(m,{type:"close"})))),t.createElement(ce,{ref:P,onClick:S,grabbing:Q},Z))};export default de;
