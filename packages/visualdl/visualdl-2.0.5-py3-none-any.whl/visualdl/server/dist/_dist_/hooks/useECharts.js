import{useCallback as n,useEffect as y,useLayoutEffect as v,useMemo as g,useRef as a,useState as f}from"../../web_modules/react.js";import{position as S,primaryColor as w,size as A}from"../utils/style.js";import{dataURL2Blob as T}from"../utils/image.js";import{saveAs as k}from"../../web_modules/file-saver.js";import I from"../../web_modules/styled-components.js";import{themes as u}from"../utils/theme.js";import b from"./useTheme.js";const j=o=>{const l=a(null),[e,i]=f(null),c=b(),m=a(o.onInit),p=a(o.onDispose),s=n(()=>e==null?void 0:e.dispatchAction({type:"hideTip"}),[e]),h=n(()=>{(async()=>{if(!l.current)return;const{default:t}=await import("../../web_modules/echarts.js");o.gl&&await import("../../web_modules/echarts-gl.js");const r=t.init(l.current);l.current.addEventListener("mouseleave",s),setTimeout(()=>{if(o.zoom&&r.dispatchAction({type:"takeGlobalCursor",key:"dataZoomSelect",dataZoomSelectActive:!0}),r){var d;(d=m.current)===null||d===void 0||d.call(m,r)}},0),i(r)})()},[o.gl,o.zoom,s]),x=n(()=>{if(e){var t,r;(t=p.current)===null||t===void 0||t.call(p,e),e.dispose(),(r=l.current)===null||r===void 0||r.removeEventListener("mouseleave",s),i(null)}},[s,e]);y(()=>(h(),x),[h,x]),y(()=>{o.loading?e==null||e.showLoading("default",{text:"",color:w,textColor:u[c].textColor,maskColor:u[c].maskColor,zlevel:0}):e==null||e.hideLoading()},[o.loading,c,e]);const C=a(null);v(()=>{if(o.autoFit){const t=C.current;if(t){const r=new ResizeObserver(()=>{e==null||e.resize()});return r.observe(t),()=>r.unobserve(t)}}},[o.autoFit,e]);const L=n(t=>{if(e){const r=T(e.getDataURL({type:"png",pixelRatio:2,backgroundColor:"#FFF"}));k(r,`${(t==null?void 0:t.replace(/[/\\?%*:|"<>]/g,"_"))||"chart"}.png`)}},[e]);return{ref:l,echart:e,wrapper:C,saveAsImage:L}};export default j;export const Wrapper=I.div.withConfig({displayName:"useECharts__Wrapper",componentId:"b4c6ck-0"})(["position:relative;display:flex;justify-content:center;align-items:stretch;> .echarts{width:100%;}> .loading{"," "," display:flex;justify-content:center;align-items:center;}"],A("100%"),S("absolute",0,null,null,0)),useChartTheme=o=>{const l=b(),e=g(()=>u[l],[l]),i=g(()=>o?{title:{textStyle:{color:e.textColor}},tooltip:{backgroundColor:e.tooltipBackgroundColor,borderColor:e.tooltipBackgroundColor,textStyle:{color:e.tooltipTextColor}},xAxis3D:{nameTextStyle:{color:e.textLighterColor},axisLabel:{color:e.textLighterColor},axisLine:{lineStyle:{color:e.borderColor}},splitLine:{lineStyle:{color:e.borderColor}}},yAxis3D:{nameTextStyle:{color:e.textLighterColor},axisLabel:{color:e.textLighterColor},axisLine:{lineStyle:{color:e.borderColor}},splitLine:{lineStyle:{color:e.borderColor}}},zAxis3D:{nameTextStyle:{color:e.textLighterColor},axisLabel:{color:e.textLighterColor},axisLine:{lineStyle:{color:e.borderColor}},splitLine:{lineStyle:{color:e.borderColor}}}}:{title:{textStyle:{color:e.textColor}},tooltip:{backgroundColor:e.tooltipBackgroundColor,borderColor:e.tooltipBackgroundColor,textStyle:{color:e.tooltipTextColor}},xAxis:{nameTextStyle:{color:e.textLighterColor},axisLabel:{color:e.textLighterColor},axisLine:{lineStyle:{color:e.borderColor}},splitLine:{lineStyle:{color:e.borderColor}}},yAxis:{nameTextStyle:{color:e.textLighterColor},axisLabel:{color:e.textLighterColor},axisLine:{lineStyle:{color:e.borderColor}},splitLine:{lineStyle:{color:e.borderColor}}}},[e,o]);return i};
