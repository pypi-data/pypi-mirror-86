

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Configuration &mdash; Benji Backup 0.11.0+dirty documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/asciinema/asciinema-player.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script src="_static/asciinema/asciinema-player.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Backup" href="backup.html" />
    <link rel="prev" title="Quick Start" href="quickstart.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Benji Backup
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#fedora-27-and-up">Fedora 27 and up</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#opensuse">openSUSE</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#rhel-centos-7">RHEL/CentOS 7</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#ubuntu-16-04">Ubuntu 16.04</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#common-to-all-distributions">Common to All Distributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#ceph-rbd-support">Ceph RBD Support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#some-vocabulary">Some Vocabulary</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#backup">Backup</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#deep-scrub-and-scrub">Deep Scrub and Scrub</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#restore">Restore</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#version-removal-and-cleanup">Version Removal and Cleanup</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#configuration-file-location">Configuration File Location</a></li>
<li class="toctree-l2"><a class="reference internal" href="#top-level-configuration-directives">Top-level configuration directives</a></li>
<li class="toctree-l2"><a class="reference internal" href="#list-of-i-o-configurations">List of I/O Configurations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#list-of-transform-configurations">List of Transform Configurations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#list-of-storage-configurations">List of Storage Configurations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#i-o-modules">I/O Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#i-o-module-file">I/O Module file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#i-o-module-rbd">I/O Module rbd</a></li>
<li class="toctree-l3"><a class="reference internal" href="#i-o-module-rbdaio">I/O Module rbdaio</a></li>
<li class="toctree-l3"><a class="reference internal" href="#i-o-module-iscsi">I/O Module iscsi</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#transform-modules">Transform Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#transform-module-zstd">Transform Module zstd</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transform-module-aes-256-gcm">Transform Module aes_256_gcm</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transform-module-aes-256-gcm-ecc">Transform Module aes_256_gcm_ecc</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#storage-modules">Storage Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hmac">HMAC</a></li>
<li class="toctree-l3"><a class="reference internal" href="#read-cache">Read Cache</a></li>
<li class="toctree-l3"><a class="reference internal" href="#storage-module-file">Storage Module file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#storage-module-s3">Storage Module s3</a></li>
<li class="toctree-l3"><a class="reference internal" href="#storage-module-b2">Storage Module b2</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#nbd">NBD</a></li>
<li class="toctree-l2"><a class="reference internal" href="#multiple-instance-installations">Multiple Instance Installations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="backup.html">Backup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="backup.html#simple-backup">Simple Backup</a></li>
<li class="toctree-l2"><a class="reference internal" href="backup.html#versions">Versions</a></li>
<li class="toctree-l2"><a class="reference internal" href="backup.html#differential-backup">Differential Backup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="backup.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="backup.html#specifying-a-block-size">Specifying a block size</a></li>
<li class="toctree-l2"><a class="reference internal" href="backup.html#labeling-versions">Labeling <em>Versions</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="backup.html#the-hints-file">The Hints File</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="scrub.html">Scrub</a><ul>
<li class="toctree-l2"><a class="reference internal" href="scrub.html#reasons-for-scrubbing">Reasons for Scrubbing</a></li>
<li class="toctree-l2"><a class="reference internal" href="scrub.html#scrubbing-methods">Scrubbing Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="scrub.html#consistency-and-checksum">Consistency and Checksum</a></li>
<li class="toctree-l3"><a class="reference internal" href="scrub.html#using-the-backup-source">Using the Backup Source</a></li>
<li class="toctree-l3"><a class="reference internal" href="scrub.html#consistency-only">Consistency Only</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="scrub.html#batch-scrubbing">Batch scrubbing</a></li>
<li class="toctree-l2"><a class="reference internal" href="scrub.html#scrubbing-failures">Scrubbing Failures</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="restore.html">Restore</a><ul>
<li class="toctree-l2"><a class="reference internal" href="restore.html#restoring">Restoring</a><ul>
<li class="toctree-l3"><a class="reference internal" href="restore.html#restoring-without-a-database">Restoring without a database</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="restore.html#nbd-server">NBD Server</a><ul>
<li class="toctree-l3"><a class="reference internal" href="restore.html#known-issues-with-nbd-client">Known Issues with nbd-client</a></li>
<li class="toctree-l3"><a class="reference internal" href="restore.html#read-only-mount">Read-Only Mount</a></li>
<li class="toctree-l3"><a class="reference internal" href="restore.html#read-write-mount">Read-Write Mount</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="restore.html#restoring-invalid-versions">Restoring Invalid <em>Versions</em></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="enforce.html">Retention Policy Enforcement</a><ul>
<li class="toctree-l2"><a class="reference internal" href="enforce.html#policy-specification">Policy Specification</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cleanup.html">Cleanup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cleanup.html#removing-old-versions">Removing old versions</a></li>
<li class="toctree-l2"><a class="reference internal" href="cleanup.html#id1">Cleanup</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="statistics.html">Storage Statistics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="statistics.html#id1">Storage Statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="statistics.html#space-usage-statistics">Space Usage Statistics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="administration.html">Administration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="administration.html#securing-version-metadata">Securing Version Metadata</a><ul>
<li class="toctree-l3"><a class="reference internal" href="administration.html#backups-and-exports">Backups and Exports</a></li>
<li class="toctree-l3"><a class="reference internal" href="administration.html#database-high-availability">Database High-Availability</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="administration.html#securing-block-data-on-storages">Securing Block Data on Storages</a></li>
<li class="toctree-l2"><a class="reference internal" href="administration.html#monitoring">Monitoring</a><ul>
<li class="toctree-l3"><a class="reference internal" href="administration.html#general-advise">General Advise</a></li>
<li class="toctree-l3"><a class="reference internal" href="administration.html#machine-output">Machine output</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="container.html">Containerized Benji</a><ul>
<li class="toctree-l2"><a class="reference internal" href="container.html#images">Images</a><ul>
<li class="toctree-l3"><a class="reference internal" href="container.html#benji">benji</a></li>
<li class="toctree-l3"><a class="reference internal" href="container.html#benji-k8s">benji-k8s</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="container.html#helm-charts">Helm Charts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="container.html#id1">benji-k8s</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="filter_expressions.html">Filter Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="datalayout.html">Data Layout</a><ul>
<li class="toctree-l2"><a class="reference internal" href="datalayout.html#database-backend">Database Backend</a></li>
<li class="toctree-l2"><a class="reference internal" href="datalayout.html#block-storages">Block Storages</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a><ul>
<li class="toctree-l2"><a class="reference internal" href="support.html#issue-tracker">Issue Tracker</a></li>
<li class="toctree-l2"><a class="reference internal" href="support.html#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="support.html#security">Security</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="licenses.html">Licenses</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Benji Backup</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Configuration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/configuration.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="configuration">
<span id="id1"></span><h1>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h1>
<div class="section" id="configuration-file-location">
<h2>Configuration File Location<a class="headerlink" href="#configuration-file-location" title="Permalink to this headline">¶</a></h2>
<p>Benji will by default search the following locations for configuration files:</p>
<ul class="simple">
<li><p>/etc/benji.yaml</p></li>
<li><p>/etc/benji/benji.yaml</p></li>
<li><p>~/.benji.yaml</p></li>
<li><p>~/benji.yaml</p></li>
</ul>
<p>If multiple of these files exist, only the first file found is read.</p>
<p>In order to explicitly pass a configuration file, use the <code class="docutils literal notranslate"><span class="pre">-c</span></code> (or
<code class="docutils literal notranslate"><span class="pre">--configfile</span></code>) parameter.</p>
</div>
<div class="section" id="top-level-configuration-directives">
<h2>Top-level configuration directives<a class="headerlink" href="#top-level-configuration-directives" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>key: <strong>configurationVersion</strong></p></li>
<li><p>type: string (integer is also accepted)</p></li>
<li><p>required</p></li>
</ul>
<p>Currently this is always <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
<ul class="simple">
<li><p>key: <strong>logFile</strong></p></li>
<li><p>type: string</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">null</span></code></p></li>
</ul>
<p>Benji will by default log INFO, WARNING and ERROR to this file. If you also
need DEBUG information, please start Benji with <code class="docutils literal notranslate"><span class="pre">--log-level</span> <span class="pre">DEBUG</span></code>.
Setting this to null disables logging to a file, this might be useful when
running Benji inside a container.</p>
<ul class="simple">
<li><p>key: <strong>blockSize</strong></p></li>
<li><p>type: integer</p></li>
<li><p>unit: bytes</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">4194304</span></code> (4MiB)</p></li>
</ul>
<p>The block size can be changed on the command line on a version by version
basis, but be aware that this will affect deduplication and increase the
space usage. One possible use case for different block sizes would be backing
up LVM volumes and Ceph images with the same Benji installation. While for Ceph
4MiB is usually the best size, LVM volume might profit from a smaller block size.</p>
<ul class="simple">
<li><p>key: <strong>hashFunction</strong></p></li>
<li><p>type: string</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">BLAKE2b,digest_bits=256</span></code></p></li>
</ul>
<p>Hash function to use for calculating block checksums. There is normally no reason
to change the default. <strong>Do not change this setting when backups already exist.</strong></p>
<ul class="simple">
<li><p>key: <strong>processName</strong></p></li>
<li><p>type: string</p></li>
<li><p>default : <code class="docutils literal notranslate"><span class="pre">benji</span></code></p></li>
</ul>
<p>This name will be used to identify a specific instance of Benji in the process list
and  can be used to distinguish several parallel installations.</p>
<ul class="simple">
<li><p>key: <strong>disallowRemoveWhenYounger</strong></p></li>
<li><p>type: integer</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">6</span></code></p></li>
</ul>
<p>This settings disallows removal of backup versions if they are younger than the
specified number of days. Set to 0 to disable, i.e. to be able to delete any
backup version regardless of its age.</p>
<ul class="simple">
<li><p>key: <strong>databaseEngine</strong></p></li>
<li><p>type: string</p></li>
<li><p>required</p></li>
</ul>
<p>See <a class="reference external" href="https://docs.sqlalchemy.org/en/latest/core/engines.html">https://docs.sqlalchemy.org/en/latest/core/engines.html</a> for options.
Only PostgreSQL (dialect psycopg2) and SQLite 3 are tested with during development.</p>
<ul class="simple">
<li><p>key: <strong>ios</strong></p></li>
<li><p>type: list of dictionaries</p></li>
<li><p>required</p></li>
</ul>
<p>List of I/O configurations. Backup sources are accessed via these configurations.
They are also used as a destination during restore operations. See below.</p>
<ul class="simple">
<li><p>key: <strong>storages</strong></p></li>
<li><p>type: list of dictionaries</p></li>
<li><p>required</p></li>
</ul>
<p>List of storage configurations used for storing backup versions. See below.</p>
<ul class="simple">
<li><p>key: <strong>defaultStorage</strong></p></li>
<li><p>type: string</p></li>
<li><p>required</p></li>
</ul>
<p>Default storage for storing backup versions. Reference to a storage name.</p>
<ul class="simple">
<li><p>key: <strong>transforms</strong></p></li>
<li><p>type: list of dictionaries</p></li>
<li><p>default: empty list</p></li>
</ul>
<p>List of data transformation configurations. See below.</p>
<ul class="simple">
<li><p>key: <strong>nbd</strong></p></li>
<li><p>type: dictionary</p></li>
<li><p>default: see below</p></li>
</ul>
<p>Configuration options pertaining to Benji’s NBD server.</p>
</div>
<div class="section" id="list-of-i-o-configurations">
<h2>List of I/O Configurations<a class="headerlink" href="#list-of-i-o-configurations" title="Permalink to this headline">¶</a></h2>
<p>The list of I/O configurations (<strong>ios</strong>) is a list of dictionaries with the
following keys:</p>
<ul class="simple">
<li><p>key: <strong>name</strong></p></li>
<li><p>type: string</p></li>
<li><p>default: none</p></li>
</ul>
<p>This sets the name of this I/O configuration entry. It is used as the
scheme in backup source or restore destination specifications.</p>
<ul class="simple">
<li><p>key: <strong>module</strong></p></li>
<li><p>type: string</p></li>
<li><p>default: none</p></li>
</ul>
<p>Reference to a I/O module name. See below.</p>
<ul class="simple">
<li><p>key: <strong>configuration</strong></p></li>
<li><p>type: list of dictionaries</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">null</span></code></p></li>
</ul>
<p>Module specific configuration for this I/O configuration entry.</p>
</div>
<div class="section" id="list-of-transform-configurations">
<h2>List of Transform Configurations<a class="headerlink" href="#list-of-transform-configurations" title="Permalink to this headline">¶</a></h2>
<p>The list of transform configuration (<strong>transforms</strong>) is a list of
dictionaries with the following keys:</p>
<ul class="simple">
<li><p>key: <strong>name</strong></p></li>
<li><p>type: string</p></li>
<li><p>default: none</p></li>
</ul>
<p>This sets the name of this transform configuration entry. It is
referenced in the list of <strong>activeTransforms</strong>.</p>
<ul class="simple">
<li><p>key: <strong>module</strong></p></li>
<li><p>type: string</p></li>
<li><p>default: none</p></li>
</ul>
<p>Reference to a transform module name. See below.</p>
<ul class="simple">
<li><p>key: <strong>configuration</strong></p></li>
<li><p>type: list of dictionaries</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">null</span></code></p></li>
</ul>
<p>Module specific configuration for this transform configuration entry.</p>
</div>
<div class="section" id="list-of-storage-configurations">
<h2>List of Storage Configurations<a class="headerlink" href="#list-of-storage-configurations" title="Permalink to this headline">¶</a></h2>
<p>The list of storage configurations (<strong>storages</strong>) is a list of dictionaries
with the following keys:</p>
<ul class="simple">
<li><p>key: <strong>name</strong></p></li>
<li><p>type: string</p></li>
<li><p>default: none</p></li>
</ul>
<p>This sets the name of this storage configuration entry. It is referenced by
the <strong>defaultStorage</strong> top-level configuration directive or it is specified
on the command line.</p>
<ul class="simple">
<li><p>key: <strong>module</strong></p></li>
<li><p>type: string</p></li>
<li><p>default: none</p></li>
</ul>
<p>Reference to a storage module name. See below.</p>
<ul class="simple">
<li><p>key: <strong>storageId</strong></p></li>
<li><p>type: integer</p></li>
<li><p>default: none</p></li>
</ul>
<p>This sets the internal storage id for this storage configuration. It is no longer necessary to populate
this configuration key as the storage id is now assigned automatically. This option only exists for
backward compatibility with older configurations and should not be used in new configurations.</p>
<ul class="simple">
<li><p>key: <strong>configuration</strong></p></li>
<li><p>type: list of dictionaries</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">null</span></code></p></li>
</ul>
<p>Module specific configuration for this storage configuration entry.</p>
</div>
<div class="section" id="i-o-modules">
<h2>I/O Modules<a class="headerlink" href="#i-o-modules" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>name: <strong>simultaneousReads</strong></p></li>
<li><p>type: integer</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">1</span></code></p></li>
</ul>
<p>Number of reader threads when reading from a backup source. Also
affects the internal read queue length. It is highly recommended to
increase this number to get better concurrency
and performance.</p>
<ul class="simple">
<li><p>name: <strong>simultaneousWrites</strong></p></li>
<li><p>type: integer</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">1</span></code></p></li>
</ul>
<p>Number of writer threads when restoring a version. Also affects the internal write queue length. It is highly
recommended to increase this number to get better concurrency and performance.</p>
<div class="section" id="i-o-module-file">
<h3>I/O Module file<a class="headerlink" href="#i-o-module-file" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">file</span></code> I/O module supports the following configuration options:</p>
<ul class="simple">
<li><p>name: <strong>simultaneousReads</strong></p></li>
<li><p>type: integer</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">1</span></code></p></li>
</ul>
<p>Number of reader threads when reading from a backup source. Also
affects the internal read queue length. It is highly recommended to
increase this number to get better concurrency and performance.</p>
<ul class="simple">
<li><p>name: <strong>simultaneousWrites</strong></p></li>
<li><p>type: integer</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">1</span></code></p></li>
</ul>
<p>Number of writer threads when restoring a version. Also affects the internal write queue length. It is highly
recommended to increase this number to get better concurrency and performance.</p>
</div>
<div class="section" id="i-o-module-rbd">
<h3>I/O Module rbd<a class="headerlink" href="#i-o-module-rbd" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">rbd</span></code> I/O module requires that Ceph’s Python modules <code class="docutils literal notranslate"><span class="pre">rados</span></code> and <code class="docutils literal notranslate"><span class="pre">rbd</span></code> are installed. With it it is
possible to backup RBD images of a Ceph cluster. The supported URL syntax is:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;module instance&gt;:&lt;pool&gt;/&lt;image&gt;
&lt;module instance&gt;:&lt;pool&gt;/&lt;image&gt;@&lt;snapshot&gt;
</pre></div>
</div>
<p>Additional options can be passed as query parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">client_identifier</span></code>: Overrides the <code class="docutils literal notranslate"><span class="pre">clientIdentfier</span></code> from the module instance’s configuration</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mon_host</span></code>: Comma separated list of monitor hosts, either host names or IP addresses, optionally with a port number
(<code class="docutils literal notranslate"><span class="pre">&lt;host&gt;:&lt;port&gt;</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key</span></code>: Verbatim Cephx key</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">keyring</span></code>: Path to a CephX keyring file</p></li>
<li><p>any other Ceph configuration options</p></li>
</ul>
<p>Full example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rbd:pool/image@snapshot?client_identifier<span class="o">=</span>guest<span class="p">&amp;</span><span class="nv">mon_host</span><span class="o">=</span><span class="m">10</span>.0.0.1:6789,10.0.0.2:6789<span class="p">&amp;</span><span class="nv">key</span><span class="o">=</span>XXXXXXXX
</pre></div>
</div>
<p>This module supports the following configuration options:</p>
<ul class="simple">
<li><p>name: <strong>simultaneousReads</strong></p></li>
<li><p>type: integer</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">1</span></code></p></li>
</ul>
<p>Number of reader threads when reading from a backup source. Also
affects the internal read queue length. It is highly recommended to
increase this number to get better concurrency
and performance.</p>
<ul class="simple">
<li><p>name: <strong>simultaneousWrites</strong></p></li>
<li><p>type: integer</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">1</span></code></p></li>
</ul>
<p>Number of writer threads when restoring a version. Also affects the internal write queue length. It is highly
recommended to increase this number to get better concurrency and performance.</p>
<ul class="simple">
<li><p>name: <strong>cephConfigFile</strong></p></li>
<li><p>type: string</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">/etc/ceph/ceph.conf</span></code></p></li>
</ul>
<p>Sets the path to the Ceph configuration file used by this I/O configuration.</p>
<ul class="simple">
<li><p>name: <strong>clientIdentifier</strong></p></li>
<li><p>type: string</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">admin</span></code></p></li>
</ul>
<p>Sets the name of the client identifier used by this I/O configuration to
access the Ceph RBD service.</p>
<ul class="simple">
<li><p>name: <strong>newImageFeatures</strong></p></li>
<li><p>type: list of strings</p></li>
<li><p>default: none, required</p></li>
</ul>
<p>Valid values for this list are extracted from the installed Ceph RBD
libraries. For recent version of Ceph this list of possible image
features applies: <code class="docutils literal notranslate"><span class="pre">RBD_FEATURE_LAYERING</span></code>, <code class="docutils literal notranslate"><span class="pre">RBD_FEATURE_EXCLUSIVE_LOCK</span></code>,
<code class="docutils literal notranslate"><span class="pre">RBD_FEATURE_STRIPINGV2</span></code>, <code class="docutils literal notranslate"><span class="pre">RBD_FEATURE_OBJECT_MAP</span></code>,
<code class="docutils literal notranslate"><span class="pre">RBD_FEATURE_FAST_DIFF</span></code>, <code class="docutils literal notranslate"><span class="pre">RBD_FEATURE_DEEP_FLATTEN</span></code>.</p>
</div>
<div class="section" id="i-o-module-rbdaio">
<h3>I/O Module rbdaio<a class="headerlink" href="#i-o-module-rbdaio" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">rbdaio</span></code> I/O module requires that Ceph’s Python modules <code class="docutils literal notranslate"><span class="pre">rados</span></code> and <code class="docutils literal notranslate"><span class="pre">rbd</span></code> are installed. The configuration
options are identical to the <code class="docutils literal notranslate"><span class="pre">rbd</span></code> module but instead of using multiple threads the asynchronous I/O support of
<code class="docutils literal notranslate"><span class="pre">librbd</span></code> is used to access the images and snapshots. This module is relatively new and has not seen much testing.
Some non-methodical testing shows that the performance is about 10 to 20 percent better than the <code class="docutils literal notranslate"><span class="pre">rbd</span></code> module. It
is planned that this module is going to replace the <code class="docutils literal notranslate"><span class="pre">rbd</span></code> module in the future.</p>
</div>
<div class="section" id="i-o-module-iscsi">
<h3>I/O Module iscsi<a class="headerlink" href="#i-o-module-iscsi" title="Permalink to this headline">¶</a></h3>
<p>This I/O module requires a special version of the <code class="docutils literal notranslate"><span class="pre">libiscsi</span></code> Python bindings available at
<a class="reference external" href="https://github.com/elemental-lf/libiscsi-python">https://github.com/elemental-lf/libiscsi-python</a>. It currently has some limitations:</p>
<ul class="simple">
<li><p>Single-threaded synchronous execution of iSCSI commands limiting achievable performance</p></li>
<li><p>No usage of <code class="docutils literal notranslate"><span class="pre">GET_LBA_STATUS</span></code> to detect unmapped regions</p></li>
</ul>
<p>The following configuration options are supported:</p>
<ul class="simple">
<li><p>name: <strong>username</strong></p></li>
<li><p>type: string</p></li>
<li><p>default: none</p></li>
</ul>
<p>Sets the CHAP username for iSCSI authentication and authorization. If this directive is not set,
no authentication is attempted.</p>
<ul class="simple">
<li><p>name: <strong>password</strong></p></li>
<li><p>type: string</p></li>
<li><p>default: none</p></li>
</ul>
<p>Sets the CHAP password for iSCSI authentication and authorization.</p>
<ul class="simple">
<li><p>name: <strong>targetUsername</strong></p></li>
<li><p>type: string</p></li>
<li><p>default: none</p></li>
</ul>
<p>Sets the CHAP username for iSCSI target authentication. If this directive is not set, no authentication
of the target is done.</p>
<ul class="simple">
<li><p>name: <strong>targetPassword</strong></p></li>
<li><p>type: string</p></li>
<li><p>default: none</p></li>
</ul>
<p>Sets the CHAP password for iSCSI target authentication.</p>
<ul class="simple">
<li><p>name: <strong>headerDigest</strong></p></li>
<li><p>type: string</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">NONE_CRC32C</span></code></p></li>
</ul>
<p>Sets the header digest order advertised during negotiation. Possible values are: <code class="docutils literal notranslate"><span class="pre">NONE</span></code>, <code class="docutils literal notranslate"><span class="pre">NONE_CRC32C</span></code>,
<code class="docutils literal notranslate"><span class="pre">CRC32C_NONE</span></code>, and <code class="docutils literal notranslate"><span class="pre">CRC32C</span></code>.</p>
<ul class="simple">
<li><p>name: <strong>initiatorName</strong></p></li>
<li><p>type: string</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">iqn.2019-04.me.benji-backup:benji</span></code></p></li>
</ul>
<p>Sets the initiator name.</p>
<ul class="simple">
<li><p>name: <strong>timeout</strong></p></li>
<li><p>type: string</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">0</span></code> meaning unlimited</p></li>
</ul>
<p>Sets the iSCSI timeout.</p>
</div>
</div>
<div class="section" id="transform-modules">
<h2>Transform Modules<a class="headerlink" href="#transform-modules" title="Permalink to this headline">¶</a></h2>
<p>The name given to a transform configuration is saved together with the data
object to the storage. This means that you must be careful when changing the
configuration after a transform has been used by a storage. For example
you can’t just change the encryption key because you will lose access to
all data objects already encrypted with the old key. But you can create
a new encryption configuration with a new name and use it instead in
the list of <strong>activeTransforms</strong> of your storage. All newly create data
objects will then use this new transform. Old objects will still be
encrypted with the old key but they can still be decrypted as long as
the old encryption configuration is available under the old name. Key
rollover is not yet implemented.</p>
<p>It is harmless to change the compression level. But this change will only
affect newly create data objects.</p>
<div class="section" id="transform-module-zstd">
<h3>Transform Module zstd<a class="headerlink" href="#transform-module-zstd" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">zstd</span></code> module supports the following configuration
options:</p>
<ul class="simple">
<li><p>name: <strong>level</strong></p></li>
<li><p>type: integer</p></li>
<li><p>default: none, required</p></li>
</ul>
<p>The compression level used for compressing blocks of data.</p>
<ul class="simple">
<li><p>name: <strong>dictDataFile</strong></p></li>
<li><p>type: string</p></li>
<li><p>default: none</p></li>
</ul>
<p>Sets the path to a zstandard dictionary. This option has limited value in the
context of Benji and shouldn’t be set.</p>
</div>
<div class="section" id="transform-module-aes-256-gcm">
<h3>Transform Module aes_256_gcm<a class="headerlink" href="#transform-module-aes-256-gcm" title="Permalink to this headline">¶</a></h3>
<p>This module encrypts each data block with its own randomly generated key
by using AES-256 in GCM mode. The random key is then encrypted with
a master key by using the key wrapping algorithm specified in RFC 3394
and then saved beside the data block.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">aes_256_gcm</span></code> module supports the following configuration
options:</p>
<ul class="simple">
<li><p>name: <strong>kdfSalt</strong></p></li>
<li><p>type: binary string encoded with BASE64</p></li>
<li><p>default: none</p></li>
</ul>
<p>Sets the salt for the key derivation function.</p>
<ul class="simple">
<li><p>name: <strong>kdfIterations</strong></p></li>
<li><p>type: integer</p></li>
<li><p>default: none</p></li>
</ul>
<p>Sets the number of iterations for the key derivation function.</p>
<ul class="simple">
<li><p>name: <strong>password</strong></p></li>
<li><p>type: string</p></li>
<li><p>default: none</p></li>
</ul>
<p>Sets the password from which the master key is generated.</p>
<ul class="simple">
<li><p>name: <strong>masterKey</strong></p></li>
<li><p>type: binary string with a length of 32 bytes encoded with BASE64</p></li>
<li><p>default: none</p></li>
</ul>
<p>Sets the master key used for encrypting the envelope keys. This key should
have a high entropy. In most cases it is safer and easier to derive
the key from a <strong>password</strong>.</p>
<p>The <strong>masterKey</strong> configuration directive is mutually exclusive
to the other three directives.</p>
<p>When the <strong>masterKey</strong> directive is not set the master key is derived from
the other three configuration directives by using PBKDF2 with SHA-512.</p>
<p>Regarding kdfSalt and kdfIterations: It is highly recommended to generate
your own random salt and chose your own number of iterations. Don’t change
the salt and iteration count after writing encrypted data objects,  they
cannot be decrypted anymore.</p>
</div>
<div class="section" id="transform-module-aes-256-gcm-ecc">
<h3>Transform Module aes_256_gcm_ecc<a class="headerlink" href="#transform-module-aes-256-gcm-ecc" title="Permalink to this headline">¶</a></h3>
<p>This module encrypts each data block using the <code class="docutils literal notranslate"><span class="pre">aes_256_gcm</span></code> module
(see above). Instead of specifying a symmetric master key, the encryption
key is encrypted asymmetrically using elliptic curve cryptography. The
implementation is based on the algorithm outlined in the ebook
<a class="reference external" href="https://cryptobook.nakov.com/asymmetric-key-ciphers/ecc-encryption-decryption">Practical Cryptography for Developers</a>.</p>
<p>The idea of this module is that the configuration used for backup does not
need to include the private key of the ECC key pair and so cannot decrypt any
of the data once it has been stored. For restore and deep-scrubbing operations
the private key is still needed but this key can be confined to a separate
specifically secured installation of Benji.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">aes_256_gcm_ecc</span></code> module supports the following configuration options:</p>
<ul class="simple">
<li><p>name: <strong>eccKey</strong></p></li>
<li><p>type: BASE64-encoded DER representation of a ECC key (public or private)</p></li>
<li><p>default: none</p></li>
</ul>
<p>Specify the encryption keyfile to encrypt a block’s symmetric key.
For backup (encryption-only) this should be the public key only.
For restore (decryption) this must include the private key.</p>
<ul class="simple">
<li><p>name: <strong>eccCurve</strong></p></li>
<li><p>type: string</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">NIST</span> <span class="pre">P-384</span></code></p></li>
</ul>
<p>The ECC curve to use. Valid values are ‘NIST P-256’, ‘NIST P-384’ and ‘NIST P-521’.</p>
<p>Example python code to create a valid ECC key for <strong>eccKey</strong> (using <code class="docutils literal notranslate"><span class="pre">PyCryptodome</span></code>):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>from base64 import b64encode
from Crypto.PublicKey import ECC
<span class="nv">key</span> <span class="o">=</span> ECC.generate<span class="o">(</span><span class="nv">curve</span><span class="o">=</span><span class="s1">&#39;NIST P-384&#39;</span><span class="o">)</span>
<span class="nv">public_key</span> <span class="o">=</span> b64encode<span class="o">(</span>key.public_key<span class="o">()</span>.export_key<span class="o">(</span><span class="nv">format</span><span class="o">=</span><span class="s1">&#39;DER&#39;</span>, <span class="nv">compress</span><span class="o">=</span>True<span class="o">))</span>.decode<span class="o">(</span><span class="s1">&#39;ascii&#39;</span><span class="o">)</span>
<span class="nv">private_key</span> <span class="o">=</span> b64encode<span class="o">(</span>key.export_key<span class="o">(</span><span class="nv">format</span><span class="o">=</span><span class="s1">&#39;DER&#39;</span>, <span class="nv">compress</span><span class="o">=</span>True<span class="o">))</span>.decode<span class="o">(</span><span class="s1">&#39;ascii&#39;</span><span class="o">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="storage-modules">
<h2>Storage Modules<a class="headerlink" href="#storage-modules" title="Permalink to this headline">¶</a></h2>
<p>All storage modules support the following configuration directives:</p>
<ul class="simple">
<li><p>name: <strong>simultaneousReads</strong></p></li>
<li><p>type: integer</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">1</span></code></p></li>
</ul>
<p>Number of reader threads when reading from a storage. Also affects the internal read queue length. It is highly
recommended to increase this number to get better concurrency and performance.</p>
<ul class="simple">
<li><p>name: <strong>simultaneousWrites</strong></p></li>
<li><p>type: integer</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">1</span></code></p></li>
</ul>
<p>Number of writer threads when writing to a storage. Also affects the internal write queue length. It is highly
recommended to increase this number to get better concurrency and performance.</p>
<ul class="simple">
<li><p>name: <strong>simultaneousRemovals</strong></p></li>
<li><p>type: integer</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">1</span></code></p></li>
</ul>
<p>Number of removal threads when removing blocks from a storage. Also affects the internal queue length. It is highly
recommended to increase this number to get better concurrency and performance.</p>
<ul class="simple">
<li><p>name: <strong>bandwidthRead</strong></p></li>
<li><p>type: integer</p></li>
<li><p>unit: bytes per second</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">0</span></code></p></li>
</ul>
<p>This limits the number of bytes read from the storage by second using a token
bucket algorithm. A value of <code class="docutils literal notranslate"><span class="pre">0</span></code> disables this feature.</p>
<ul class="simple">
<li><p>name: <strong>bandwidthWrite</strong></p></li>
<li><p>type: integer</p></li>
<li><p>unit: bytes per second</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">0</span></code></p></li>
</ul>
<p>This limits the number of bytes written to the storage by second using a token
bucket algorithm.  A value of <code class="docutils literal notranslate"><span class="pre">0</span></code> disables this feature.</p>
<ul class="simple">
<li><p>name: <strong>activeTransforms</strong></p></li>
<li><p>type: list of strings</p></li>
<li><p>default: empty list</p></li>
</ul>
<p>Sets a list of transformations which are applied to each data object before it is
written to the storage. The transformations are performed in order from first to
last when writing to the storage. On read the list of transformations recorded in
the object’s metadata is used in reverse order to decode the data. This makes
it possible to change the list of <code class="docutils literal notranslate"><span class="pre">activeTransforms</span></code> and so enable compression or
encryption even when there are data objects present in a storage already. The changed
transformation list will only be applied to new data objects.</p>
<ul class="simple">
<li><p>name: <strong>consistencyCheckWrites</strong></p></li>
<li><p>type: bool</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">false</span></code></p></li>
</ul>
<p>When this option is set to <code class="docutils literal notranslate"><span class="pre">true</span></code> then each write to the storage is followed
by a read checking the data integrity of the written object data and metadata.
This is intended to by used when developing new storage modules and should be
disabled during normal use as it reduces the performance significantly.</p>
<div class="section" id="hmac">
<h3>HMAC<a class="headerlink" href="#hmac" title="Permalink to this headline">¶</a></h3>
<p>The metadata for each data object in a storage is written to a separate object
accompanying it. This metadata as whole is not encrypted. To protect against
metadata corruption or malicious manipulation an object’s metadata can be
protected by a HMAC (Hash-based Message Authentication Code). Benji’s
implementation conforms to RFC 2104 and uses SHA-256 as the hash algorithm.</p>
<ul class="simple">
<li><p>name: <strong>hmac</strong></p></li>
<li><p>type: dictionary</p></li>
<li><p>default: none</p></li>
</ul>
<p>The <strong>hmac</strong> dictionary supports the following keys:</p>
<ul class="simple">
<li><p>name: <strong>kdfSalt</strong></p></li>
<li><p>type: binary string encoded with BASE64</p></li>
<li><p>default: none</p></li>
</ul>
<p>Set ths salt for the key derivation function.</p>
<ul class="simple">
<li><p>name: <strong>kdfIterations</strong></p></li>
<li><p>type: integer</p></li>
<li><p>default: none</p></li>
</ul>
<p>Sets the number of iterations for the key derivation function.</p>
<ul class="simple">
<li><p>name: <strong>password</strong></p></li>
<li><p>type: string</p></li>
<li><p>default: none</p></li>
</ul>
<p>Sets the password from which the key is generated.</p>
<ul class="simple">
<li><p>name: <strong>key</strong></p></li>
<li><p>type: binary string encoded with BASE64</p></li>
<li><p>default: none</p></li>
</ul>
<p>Sets the key used for seeding the hash function. In most cases it is safer and
easier to derive the key from a <strong>password</strong>.</p>
<p>The <strong>key</strong> configuration directive is mutually exclusive to the other
three directives.</p>
<p>When the <strong>key</strong> directive is not set the key is derived from the other
three configuration directives by using PBKDF2 with SHA-512.</p>
</div>
<div class="section" id="read-cache">
<h3>Read Cache<a class="headerlink" href="#read-cache" title="Permalink to this headline">¶</a></h3>
<p>Benji supports a read cache for all storage modules. The read cache can be
be beneficial when frequently restoring images that are mostly identical.</p>
<ul class="simple">
<li><p>name: <strong>readCache</strong></p></li>
<li><p>type: dictionary</p></li>
<li><p>default: none</p></li>
</ul>
<p>The <strong>readCache</strong> dictionary supports the following keys:</p>
<ul class="simple">
<li><p>name: <strong>directory</strong></p></li>
<li><p>type: string</p></li>
<li><p>default: none</p></li>
</ul>
<p>Sets the directory used by the cache.</p>
<ul class="simple">
<li><p>name: <strong>maximumSize</strong></p></li>
<li><p>type: integer</p></li>
<li><p>unit: bytes</p></li>
<li><p>default: none</p></li>
</ul>
<p>Maximum size of the cache in bytes.</p>
<ul class="simple">
<li><p>name: <strong>shards</strong></p></li>
<li><p>type: integer</p></li>
<li><p>default: none</p></li>
</ul>
<p>Sets the number of cache shards. Needs to be scaled together with
<strong>simultaneousReads</strong>.</p>
</div>
<div class="section" id="storage-module-file">
<h3>Storage Module file<a class="headerlink" href="#storage-module-file" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">file</span></code> storage module supports the following configuration options:</p>
<ul class="simple">
<li><p>name: <strong>path</strong></p></li>
<li><p>type: string</p></li>
<li><p>required</p></li>
</ul>
<p>Sets the path to a directory where backup version data is stored.</p>
</div>
<div class="section" id="storage-module-s3">
<h3>Storage Module s3<a class="headerlink" href="#storage-module-s3" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>name: <strong>awsAccessKeyId</strong></p></li>
<li><p>type: string</p></li>
<li><p>one of <strong>awsAccessKeyId</strong> or <strong>awsAccessKeyIdFile</strong> required</p></li>
</ul>
<p>Sets the access key id. This option and the <strong>awsAccessKeyIdFile</strong>
option are mutually exclusive.</p>
<ul class="simple">
<li><p>name: <strong>awsAccessKeyIdFile</strong></p></li>
<li><p>type: string</p></li>
<li><p>one of <strong>awsAccessKeyId</strong> or <strong>awsAccessKeyIdFile</strong> required</p></li>
</ul>
<p>Sets the access key id from a file. This option and the <strong>awsAccessKeyId</strong>
option are mutually exclusive.</p>
<ul class="simple">
<li><p>name: <strong>awsSecretAccessKey</strong></p></li>
<li><p>type: string</p></li>
<li><p>one of <strong>awsSecretAccessKey</strong> or <strong>awsSecretAccessKeyFile</strong> required</p></li>
</ul>
<p>Set the access key. This option and the <strong>awsSecretAccessKeyFile</strong>
option are mutually exclusive.</p>
<ul class="simple">
<li><p>name: <strong>awsSecretAccessKeyFile</strong></p></li>
<li><p>type: string</p></li>
<li><p>one of <strong>awsSecretAccessKey</strong> or <strong>awsSecretAccessKeyFile</strong> required</p></li>
</ul>
<p>Sets the access key from a file.This option and the <strong>awsSecretAccessKey</strong>
option are mutually exclusive.</p>
<ul class="simple">
<li><p>name: <strong>bucketName</strong></p></li>
<li><p>type: string</p></li>
<li><p>required</p></li>
</ul>
<p>Sets the bucket name.</p>
<ul class="simple">
<li><p>name: <strong>regionName</strong></p></li>
<li><p>type: string</p></li>
<li><p>default: from <code class="docutils literal notranslate"><span class="pre">boto3</span></code> library, ignored if <strong>endpointUrl</strong> is specified</p></li>
</ul>
<p>Sets the region of the bucket.</p>
<ul class="simple">
<li><p>name: <strong>useSsl</strong></p></li>
<li><p>type: bool</p></li>
<li><p>default: from <code class="docutils literal notranslate"><span class="pre">boto3</span></code> library, ignored if <strong>endpointUrl</strong> is specified</p></li>
</ul>
<p>If not set, the default of the underlying <code class="docutils literal notranslate"><span class="pre">boto3</span></code> library is used.
When this option is set to <code class="docutils literal notranslate"><span class="pre">true</span></code> then TLS is used to connect to
the S3 API endpoint. When it is set to <code class="docutils literal notranslate"><span class="pre">false</span></code> HTTP is used.</p>
<ul class="simple">
<li><p>name: <strong>endpointUrl</strong></p></li>
<li><p>type: string</p></li>
<li><p>default: none</p></li>
</ul>
<p>If not set, the default of the underlying <code class="docutils literal notranslate"><span class="pre">boto3</span></code> library is used.
This option sets the S3 API endpoint to use in URL format. If it is
specified other options like <strong>regionName</strong> and <strong>useSsl</strong> are ignored
by the underlying <code class="docutils literal notranslate"><span class="pre">boto3</span></code> library. This needs to be set to
<code class="docutils literal notranslate"><span class="pre">https://storage.googleapis.com/</span></code> when connecting to a Google Storage
bucket.</p>
<ul class="simple">
<li><p>name: <strong>addressingStyle</strong></p></li>
<li><p>type: string</p></li>
<li><p>default: none</p></li>
</ul>
<p>If not set, the default of the underlying <code class="docutils literal notranslate"><span class="pre">boto3</span></code> library is used.
Valid values are <code class="docutils literal notranslate"><span class="pre">path</span></code> and <code class="docutils literal notranslate"><span class="pre">host</span></code>. This needs to be set to <code class="docutils literal notranslate"><span class="pre">path</span></code>
when connecting to a Google Storage bucket.</p>
<ul class="simple">
<li><p>name: <strong>signatureVersion</strong></p></li>
<li><p>type: string</p></li>
<li><p>default: none</p></li>
</ul>
<p>If not set, the default of the underlying <code class="docutils literal notranslate"><span class="pre">boto3</span></code> library is used. Valid
values are <code class="docutils literal notranslate"><span class="pre">s3</span></code> for version 2 signatures and  <code class="docutils literal notranslate"><span class="pre">s3v4</span></code> for version 4
signatures.</p>
<ul class="simple">
<li><p>name: <strong>disableEncodingType</strong></p></li>
<li><p>type: bool</p></li>
<li><p>default: False</p></li>
</ul>
<p>Some S3 compatible endpoints generate errors when an encoding type is set
during some operations. Enabling this setting prevents this by not sending
this HTTP header. This needs to be set to <code class="docutils literal notranslate"><span class="pre">true</span></code> when connecting
to a Google Storage bucket.</p>
</div>
<div class="section" id="storage-module-b2">
<h3>Storage Module b2<a class="headerlink" href="#storage-module-b2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>name: <strong>accountId</strong></p></li>
<li><p>type: string</p></li>
<li><p>one of <strong>accountId</strong> or <strong>accountIdFile</strong> required</p></li>
</ul>
<p>Set the account id. This option and the <strong>accountIdFile</strong>
option are mutually exclusive.</p>
<ul class="simple">
<li><p>name: <strong>accountIdFile</strong></p></li>
<li><p>type: string</p></li>
<li><p>one of <strong>accountId</strong> or <strong>accountIdFile</strong> required</p></li>
</ul>
<p>Sets the account id from a file. This option and the <strong>accountId</strong>
option are mutually exclusive.</p>
<ul class="simple">
<li><p>name: <strong>applicationKey</strong></p></li>
<li><p>type: string</p></li>
<li><p>one of <strong>applicationKey</strong> or <strong>applicationKeyFile</strong> required</p></li>
</ul>
<p>Sets the application key. This option and the <strong>applicationKeyFile</strong>
option are mutually exclusive.</p>
<ul class="simple">
<li><p>name: <strong>applicationKeyFile</strong></p></li>
<li><p>type: string</p></li>
<li><p>one of <strong>applicationKey</strong> or <strong>applicationKeyFile</strong> required</p></li>
</ul>
<p>Sets the application key from a file. This option and the <strong>applicationKey</strong>
option are mutually exclusive.</p>
<ul class="simple">
<li><p>name: <strong>accountInfoFile</strong></p></li>
<li><p>type: string</p></li>
<li><p>default: none</p></li>
</ul>
<p>Sets the file for caching the authorization token.  If unset, the <cite>b2</cite> module
will always authorize the user with the provided account id and application
key.  But the latter operation is rate limited by BackBlaze, so if Benji is
invoked repeatably in a short time frame the login will fail. In this case
configure  this option to cache and use the authorization token in subsequent
calls of  Benji. The token will be renewed automatically when it expires.</p>
<ul class="simple">
<li><p>name: <strong>bucketName</strong></p></li>
<li><p>type: string</p></li>
<li><p>required</p></li>
</ul>
<p>Sets the bucket name.</p>
<ul class="simple">
<li><p>name: <strong>uploadAttempts</strong></p></li>
<li><p>type: integer</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">5</span></code></p></li>
</ul>
<p>Sets the number of upload attempts made by the underlying <code class="docutils literal notranslate"><span class="pre">b2</span></code> library.</p>
<ul class="simple">
<li><p>name: <strong>writeObjectAttempts</strong></p></li>
<li><p>type: integer</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">3</span></code></p></li>
</ul>
<p>Sometimes the b2 API shows transient errors during object writes. Benji will
retry writes this number of times.</p>
<ul class="simple">
<li><p>name: <strong>readObjectAttempts</strong></p></li>
<li><p>type: integer</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">3</span></code></p></li>
</ul>
<p>Sometimes the b2 API shows transient errors during object reads. Benji will
retry reads this number of times.</p>
</div>
</div>
<div class="section" id="nbd">
<h2>NBD<a class="headerlink" href="#nbd" title="Permalink to this headline">¶</a></h2>
<p>Configuration options pertaining to Benji’s NBD server are located under the top-level key <strong>nbd</strong>.
While the defaults are suitable for testing they are not suitable for a production use of the NBD server
functionality as <code class="docutils literal notranslate"><span class="pre">/tmp</span></code> generally is RAM disk today.</p>
<p>The block cache is bounded by the maximum size setting. The copy-on-write store is only used if data
is written to an NBD device and a copy-on-write <em>version</em> is created. It holds all the blocks that have
changed and will be cleaned up when the NBD device is detached and all the changed blocks have been
written into the COW <em>version</em>. This means that it can grow up to the size of all <em>versions</em> that
are attached to an NBD device in read-write mode at a time.</p>
<p>Benji’s NBD server is not protected by any form of authentication and the traffic between the NBD server
and client is not encrypted. That is why the NBD server only listens on <code class="docutils literal notranslate"><span class="pre">localhost</span></code> by default.</p>
<ul class="simple">
<li><p>name: <strong>blockCache.directory</strong></p></li>
<li><p>type: string</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">/tmp/benji/nbd/block-cache</span></code></p></li>
</ul>
<p>Sets the base directory for the block cache</p>
<ul class="simple">
<li><p>name: <strong>blockCache.maximumSize</strong></p></li>
<li><p>type: integer</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">2126512128</span></code></p></li>
</ul>
<p>Sets the approximate maximum size of the block cache. The default is 2GB.</p>
<ul class="simple">
<li><p>name: <strong>cowStore.directory</strong></p></li>
<li><p>type: string</p></li>
<li><p>default: <code class="docutils literal notranslate"><span class="pre">/tmp/benji/nbd/cow-store</span></code></p></li>
</ul>
<p>Sets the base directory for the copy-on-wrote storage area.</p>
</div>
<div class="section" id="multiple-instance-installations">
<h2>Multiple Instance Installations<a class="headerlink" href="#multiple-instance-installations" title="Permalink to this headline">¶</a></h2>
<p>You can run Benji multiple times on different machines or in different
containers simultaneously. The configurations will have to match.
This is the responsibility of the user and isn’t checked by Benji!  Be
careful to shutdown all instances before making configuration changes that
could affect other instances (like adding an encryption key).</p>
<p>Multiple instances open up the possibility to scale-out Benji for
performance reasons, to put instances where the backup source data is or to
have a dedicated instance for restores for example.</p>
<p>Locking between different instances is done via the database backend.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="backup.html" class="btn btn-neutral float-right" title="Backup" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="quickstart.html" class="btn btn-neutral float-left" title="Quick Start" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2017-2019, Lars Fenneberg, Daniel Kraft

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 


</body>
</html>