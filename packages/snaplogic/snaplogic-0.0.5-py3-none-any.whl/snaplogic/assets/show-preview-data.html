<snaplogic-javascript-output-html />
<script>
    console.log("Operation: Show Preview Data")

    // Remove empty line generated by the display(HTML())
    var outputElements = document.getElementsByClassName("output_html");
    for (i = outputElements.length - 1; i >= 0; i--) {
        if (outputElements[i].children[0].tagName === "SNAPLOGIC-JAVASCRIPT-OUTPUT-HTML") {
            outputElements[i].parentElement.remove();
        }
    }

    var inputDataStr, inputData, outputDataStr, outputData, errorDataStr, errorData, consoleData;
    inputDataStr = atob('%s');
    inputData = JSON.parse(inputDataStr);
    outputDataStr = atob('%s');
    outputData = JSON.parse(outputDataStr);
    errorDataStr = atob('%s');
    errorData = JSON.parse(errorDataStr);
    consoleDataStr = atob('%s');
    consoleData = JSON.parse(consoleDataStr);

    if (consoleData.content.trim() === "Please add the second output view of the Snap to get console data.") {
        consoleData.content = "\n\n    " + consoleData.content;
    }
    document.getElementById("snaplogic-console-box-value").innerHTML = consoleData.content;

    document.getElementById("snaplogic-input-tab").style.visibility = "visible";
    document.getElementById("snaplogic-output-tab").style.visibility = "visible";
    document.getElementById("snaplogic-error-tab").style.visibility = "visible";
    document.getElementById("snaplogic-console-tab").style.visibility = "visible";

    function renderPreviewData(dataType, previewType) {
        if (dataType === "error" && errorData.length == 0) {
            return;
        }
        var data = dataType === "input" ? inputData : dataType === "output" ? outputData : errorData;
        var x = previewType
        if (x === "json") {
            require(["https://s3.us-east-2.amazonaws.com/snaplogic-ds-public/4.15/jupyter_notebook_integration/renderjson.js"], function () {
                document.getElementById("snaplogic-" + dataType + "-box-value").innerHTML = "";
                document.getElementById("snaplogic-" + dataType + "-box-value").appendChild(renderjson.set_show_to_level(2)(data));
            })
        } else if (x === "table") {

            var tableHTML = "<table id=\"snaplogic-" + dataType + "-table\">";

            tableHTML += "<thead><tr>"
            Object.keys(data[0]).forEach(function (key) {
                tableHTML += "<th class='sortable'>";
                tableHTML += key;
                tableHTML += "<th>";
            });
            tableHTML += "</thead></tr>";

            data.forEach(function (element) {
                tableHTML += "<tr>"
                Object.keys(data[0]).forEach(function (key) {
                    tableHTML += "<td>";
                    if (typeof element[key] === 'object')
                        tableHTML += `<div class=\"snaplogic-tooltip\">Object<pre class=\"snaplogic-tooltiptext\">${escapeHTML(JSON.stringify(element[key], undefined, 2))}</pre></div>`
                    else
                        tableHTML += escapeHTML(element[key]);
                    tableHTML += "<td>";
                });
                tableHTML += "</tr>";
            });

            tableHTML += "</table>";
            document.getElementById("snaplogic-" + dataType + "-box-value").innerHTML = tableHTML;

        } else if (x === "raw") {
            document.getElementById("snaplogic-" + dataType + "-box-value").innerHTML = "";
            document.getElementById("snaplogic-" + dataType + "-box-value").innerText = JSON.stringify(data);
        }
    }

    var previewTypeList = ["input", "output", "error"];
    for (var i = 0; i < previewTypeList.length; i++) {
        var previewType = previewTypeList[i];
        document.getElementById("snaplogic-" + previewType + "-box").innerHTML = `
            <div class="snaplogic-btn-group">
                <button onclick="renderPreviewData('` + previewType + `', 'json')">JSON</button>
                <button onclick="renderPreviewData('` + previewType + `', 'table')">TABLE</button>
                <button onclick="renderPreviewData('` + previewType + `', 'raw')">RAW</button>
            </div>
            <div id="snaplogic-` + previewType + `-box-value"></div>
        `;
        renderPreviewData(previewType, "json");
    }

    if (errorData.length > 0) {
        document.getElementById("snaplogic-error-tab").click()
    }
    else {
        document.getElementById("snaplogic-output-tab").click()
    }
    document.getElementsByClassName("snaplogic-local-validate-btn")[0].style.visibility = "visible"

    document.getElementById("snaplogic-console-unwrap-button").click()

</script>